<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta property="og:site_name" content="Lettier">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Let's make a Matrix Inverse Calculator with PureScript by David Lettier">
    <meta property="og:image" content="https://lettier.github.io/images/2017-02-25-matrix-inverse-purescript/jumbotron_image.jpg">
    <meta property="og:url" content="https://lettier.github.io/posts/2017-02-25-matrix-inverse-purescript.html">
    <meta property="og:description" content="Using PureScript and the Halogen library, we build a matrix inverse calculator from the ground up.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="David Lettier">
    <meta name="description" content="Using PureScript and the Halogen library, we build a matrix inverse calculator from the ground up.">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../css/pandoc.css">
    <link rel="stylesheet" type="text/css" href="../css/default.css">
    <link rel="alternate" type="application/rss+xml" href="../rss.xml" title="RSS">
    
      <title>Let's make a Matrix Inverse Calculator with PureScript by David Lettier</title>
    
  </head>
  <body>
    <div id="top"></div>
    <nav class="navbar navbar-inverse navbar-transparent navbar-fixed-top">
      <div class="container-fluid navbar-container">
        <ul class="nav navbar-nav nav-left">
          <!--
          <li class="nav-link"><a href="/">Home</a></li>
          <li class="nav-link"><a href="/posts.html">Posts</a></li>
          -->
          <li>
            <div class="nav-icon-container">
              <a href="../" title="Home">
                <div>
                  <i class="fa fa-home nav-icon"></i>
                </div>
                <div class="nav-icon-dot">
                </div>
              </a>
            </div>
          </li>
          <li>
            <div class="nav-icon-container">
              <a href="../rss.xml" title="RSS" type="application/rss+xml" target="_blank">
                <div>
                  <i class="fa fa-rss nav-icon"></i>
                </div>
                <div class="nav-icon-dot">
                </div>
              </a>
            </div>
          </li>
          <li>
            <div class="nav-icon-container">
              <a href="../posts.html" title="Posts">
                <div>
                  <i class="fa fa-th-large nav-icon shaker"></i>
                </div>
                <div class="nav-icon-dot">
                </div>
              </a>
            </div>
          </li>
        </ul>
        <div class="nav-right">
          <!--
          <a href="http://www.lettier.com/" title="Lettier.com">
            <div class="lettier-icon">
              <img src="/images/logo.svg" width="30" height="30" alt="Lettier.com" class="lettier-icon-img">
            </div>
          </a>
          -->
          <div class="nav-icon-container">
            <a href="http://www.lettier.com/" title="Lettier.com">
              <div class="lettier-icon">
                <img src="../images/logo.svg" width="30" height="30" alt="Lettier.com" class="lettier-icon-img">
              </div>
              <div class="nav-icon-dot">
              </div>
            </a>
          </div>
          <!--
          <a href="https://www.github.com/lettier" title="Github">
            <i class="fa fa-github nav-icon"></i>
          </a>
          -->
          <div class="nav-icon-container">
            <a href="https://www.github.com/lettier" title="Github">
              <div>
                <i class="fa fa-github nav-icon"></i>
              </div>
              <div class="nav-icon-dot">
              </div>
            </a>
          </div>
          <!--
          <a href="https://www.linkedin.com/in/lettier" title="LinkedIn">
            <i class="fa fa-linkedin nav-icon"></i>
          </a>
          -->
          <div class="nav-icon-container">
            <a href="https://www.linkedin.com/in/lettier" title="LinkedIn">
              <div>
                <i class="fa fa-linkedin nav-icon"></i>
              </div>
              <div class="nav-icon-dot">
              </div>
            </a>
          </div>
          <!--
          <a href="https://stackoverflow.com/users/3838674/lettier" title="Stack Overflow">
            <i class="fa fa-stack-overflow nav-icon"></i>
          </a>
          <div class="nav-icon-container">
            <a href="https://stackoverflow.com/users/3838674/lettier" title="Stack Overflow">
              <div>
                <i class="fa fa-stack-overflow nav-icon"></i>
              </div>
              <div class="nav-icon-dot">
              </div>
            </a>
          </div>
          -->
          <!--
          <a href="https://www.hackerrank.com/lettier" title="HackerRank">
            <i class="fa fa-trophy nav-icon nav-icon-second-last"></i>
          </a>
          -->
          <div class="nav-icon-container nav-icon-container-second-last">
            <a href="https://www.hackerrank.com/lettier" title="HackerRank">
              <div>
                <i class="fa fa-trophy nav-icon nav-icon-second-last"></i>
              </div>
              <div class="nav-icon-dot">
              </div>
            </a>
          </div>
          <!--
          <a href="https://www.behance.net/dlettier" title="Behance">
            <i class="fa fa-behance nav-icon nav-icon-last"></i>
          </a>
          -->
          <div class="nav-icon-container nav-icon-container-last">
            <a href="https://www.behance.net/dlettier" title="Behance">
              <div>
                <i class="fa fa-behance nav-icon"></i>
              </div>
              <div class="nav-icon-dot">
              </div>
            </a>
          </div>
        </div>
      </div>
    </nav>
    <div class="jumbotron" style="background-image: url('/images/2017-02-25-matrix-inverse-purescript/jumbotron_image.jpg');">
      <div class="container vertical-center">
        <div class="jumbotron-text">
          <h1 class="jumbotron-text-background">
            
              Let's make a Matrix Inverse Calculator with PureScript
            
          </h1>
        </div>
      </div>
    </div>
    <div class="container page-container">
      <div class="post-header">
  <div class="display-left">
  </div>
  <div class="display-right date-author">
    <p>2017-02-25 &nbsp; <i class="fa fa-calendar"></i></p>
    
      <p>David Lettier &nbsp; <i class="fa fa-user"></i></p>
    
  </div>
</div>
<div class="post-body">
  <!--https://pixabay.com/en/storage-sort-sorting-container-1209606/-->
<h2 id="the-code-and-final-build">The Code and final build</h2>
<div class="figure">
<img src="../images/2017-02-25-matrix-inverse-purescript/ui.gif" class="post-img post-img-small post-img-limit" />

</div>
<p>You can try out the final build of the matrix inverse calculator at <a href="https://lettier.com/matrix-inverse/">lettier.com/matrix-inverse</a>. All of the code for the project is hosted on <a href="https://github.com/lettier/matrix-inverse-calculator">GitHub</a>.</p>
<h2 id="who-this-is-for">Who this is for</h2>
<ul>
<li>Haskell programmers looking to solve <a href="https://wiki.haskell.org/The_JavaScript_Problem">The JavaScript Problem</a></li>
<li>Programmers interested in functional programming</li>
<li>JavaScript programmers looking to try out PureScript</li>
<li>Web developers searching for a new approach</li>
<li>Matrix inverters</li>
</ul>
<h2 id="what-well-cover">What we’ll cover</h2>
<ul>
<li>Using Yarn and NPM scripts</li>
<li>Building Sass</li>
<li>Setting up PureScript</li>
<li>Edge cases for inverting a matrix</li>
<li>Gauss-Jordan elimination method</li>
<li>Reduced row echelon from</li>
<li>Functional programming</li>
<li>Using the Halogen library to build our UI</li>
</ul>
<h2 id="project-setup">Project setup</h2>
<p>Before we begin developing, we need to set up our project with all of its files and dependencies.</p>
<h3 id="file-structure">File structure</h3>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">matrix-inverse-calculator/</span>
  <span class="kw">dist/</span>
    <span class="kw">app.js</span>
    <span class="kw">index.css</span>
    <span class="kw">index.html</span>
  <span class="kw">src/</span>
    <span class="kw">Main.purs</span>
    <span class="kw">UI.purs</span>
    <span class="kw">MatrixInverse.purs</span>
    <span class="kw">Utils.purs</span>
  <span class="kw">static/</span>
    <span class="kw">html/</span>
      <span class="kw">index.html</span>
    <span class="kw">scss/</span>
      <span class="kw">index.scss</span>
  <span class="kw">.nvmrc</span>
  <span class="kw">bower.json</span>
  <span class="kw">package.json</span></code></pre></div>
<p>This will be layout for our project. Go ahead and run the following commands.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> -p matrix-inverse-calculator
<span class="kw">cd</span> matrix-inverse-calculator
<span class="kw">mkdir</span> -p dist src static static/html static/scss
<span class="kw">touch</span> .nvmrc bower.json package.json
<span class="kw">cd</span> src
<span class="kw">touch</span> Main.purs UI.purs MatrixInverse.purs Utils.purs
<span class="kw">cd</span> ..
<span class="kw">cd</span> static
<span class="kw">touch</span> html/index.html scss/index.scss
<span class="kw">cd</span> ..</code></pre></div>
<h2 id="nvm">NVM</h2>
<p>We will need to install <a href="https://nodejs.org/en/">Node.js</a> using <a href="https://github.com/creationix/nvm">NVM</a>. NVM allows us to easily switch between different versions of Node.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> ~/Downloads
<span class="kw">wget</span> -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.1/install.sh <span class="kw">|</span> <span class="kw">bash</span>
<span class="kw">cd</span> ~/matrix-inverse-calculator
<span class="kw">echo</span> <span class="st">'v5.5.0'</span> <span class="kw">&gt;</span> .nvmrc
<span class="kw">nvm</span> use</code></pre></div>
<h3 id="yarn">Yarn</h3>
<p>To speed up the downloading and installation of our dependencies, will we use <a href="https://yarnpkg.com/">Yarn</a>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> ~/Downloads
<span class="kw">curl</span> -o- -L https://yarnpkg.com/install.sh <span class="kw">|</span> <span class="kw">bash</span></code></pre></div>
<h3 id="npm">NPM</h3>
<p>Open up your favorite text editor and copy this into the <code>package.json</code> file.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
    <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;matrix-inverse-calculator&quot;</span><span class="op">,</span>
    <span class="st">&quot;description&quot;</span><span class="op">:</span> <span class="st">&quot;Matrix Inverse Calculator&quot;</span><span class="op">,</span>
    <span class="st">&quot;homepage&quot;</span><span class="op">:</span> <span class="st">&quot;http://lettier.com/matrix-inverse/&quot;</span><span class="op">,</span>
    <span class="st">&quot;license&quot;</span><span class="op">:</span> <span class="st">&quot;Apache-2.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;author&quot;</span><span class="op">:</span> <span class="st">&quot;David Lettier&quot;</span><span class="op">,</span>
    <span class="st">&quot;private&quot;</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
    <span class="st">&quot;scripts&quot;</span><span class="op">:</span> <span class="op">{</span>
        <span class="st">&quot;installPackages&quot;</span><span class="op">:</span> <span class="st">&quot;yarn &amp;&amp; bower install&quot;</span><span class="op">,</span>
        <span class="st">&quot;buildSrc&quot;</span><span class="op">:</span> <span class="st">&quot;pulp build&quot;</span><span class="op">,</span>
        <span class="st">&quot;buildDist&quot;</span><span class="op">:</span> <span class="st">&quot;mkdir -p dist &amp;&amp; pulp browserify --to dist/app.js &amp;&amp; node-sass static/scss/index.scss dist/index.css &amp;&amp; cp -R static/images/. dist/ &amp;&amp; cp -R static/html/. dist/&quot;</span><span class="op">,</span>
        <span class="st">&quot;watchBuildDist&quot;</span><span class="op">:</span> <span class="st">&quot;onchange './static/**/*' './src/*' -i -- yarn buildDist&quot;</span>
    <span class="op">},</span>
    <span class="st">&quot;dependencies&quot;</span><span class="op">:</span> <span class="op">{</span>
        <span class="st">&quot;onchange&quot;</span><span class="op">:</span> <span class="st">&quot;^3.2.1&quot;</span><span class="op">,</span>
        <span class="st">&quot;virtual-dom&quot;</span><span class="op">:</span> <span class="st">&quot;^2.1.1&quot;</span>
    <span class="op">},</span>
    <span class="st">&quot;devDependencies&quot;</span><span class="op">:</span> <span class="op">{</span>
        <span class="st">&quot;node-sass&quot;</span><span class="op">:</span> <span class="st">&quot;4.3.0&quot;</span><span class="op">,</span>
        <span class="st">&quot;onchange&quot;</span><span class="op">:</span> <span class="st">&quot;3.2.1&quot;</span><span class="op">,</span>
        <span class="st">&quot;pulp&quot;</span><span class="op">:</span> <span class="st">&quot;10.0.0&quot;</span><span class="op">,</span>
        <span class="st">&quot;purescript&quot;</span><span class="op">:</span> <span class="st">&quot;0.10.2&quot;</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>With this file we have four NPM scripts we can run with Yarn. <code>watchBuildDist</code> will be really convenient when we start developing as it will build the project into <code>dist/</code> each time we make a change to any of the project files. Once the project is built, we can just refresh our browser.</p>
<h3 id="bower">Bower</h3>
<p>Open up your favorite editor and copy this into the <code>bower.json</code> file.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
  <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;matrix-inverse-calculator&quot;</span><span class="op">,</span>
  <span class="st">&quot;description&quot;</span><span class="op">:</span> <span class="st">&quot;Matrix Inverse Calculator&quot;</span><span class="op">,</span>
  <span class="st">&quot;homepage&quot;</span><span class="op">:</span> <span class="st">&quot;http://lettier.com/matrix-inverse/&quot;</span><span class="op">,</span>
  <span class="st">&quot;license&quot;</span><span class="op">:</span> <span class="st">&quot;Apache-2.0&quot;</span><span class="op">,</span>
  <span class="st">&quot;authors&quot;</span><span class="op">:</span> [
    <span class="st">&quot;David Lettier&quot;</span>
  ]<span class="op">,</span>
  <span class="st">&quot;private&quot;</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
  <span class="st">&quot;ignore&quot;</span><span class="op">:</span> [
    <span class="st">&quot;**/.*&quot;</span><span class="op">,</span>
    <span class="st">&quot;node_modules&quot;</span><span class="op">,</span>
    <span class="st">&quot;bower_components&quot;</span><span class="op">,</span>
    <span class="st">&quot;output&quot;</span>
  ]<span class="op">,</span>
  <span class="st">&quot;dependencies&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;purescript-arrays&quot;</span><span class="op">:</span> <span class="st">&quot;3.1.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-console&quot;</span><span class="op">:</span> <span class="st">&quot;2.0.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-either&quot;</span><span class="op">:</span> <span class="st">&quot;2.1.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-foldable-traversable&quot;</span><span class="op">:</span> <span class="st">&quot;2.0.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-globals&quot;</span><span class="op">:</span> <span class="st">&quot;2.0.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-halogen&quot;</span><span class="op">:</span> <span class="st">&quot;*&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-integers&quot;</span><span class="op">:</span> <span class="st">&quot;2.1.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-math&quot;</span><span class="op">:</span> <span class="st">&quot;2.0.0&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-maybe&quot;</span><span class="op">:</span> <span class="st">&quot;2.0.1&quot;</span><span class="op">,</span>
    <span class="st">&quot;purescript-prelude&quot;</span><span class="op">:</span> <span class="st">&quot;2.3.0&quot;</span>
  <span class="op">},</span>
  <span class="st">&quot;devDependencies&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;purescript-psci-support&quot;</span><span class="op">:</span> <span class="st">&quot;2.0.0&quot;</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>We can now go ahead and install all of our dependencies so make sure to run the following commands.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> matrix-inverse-calculator
<span class="kw">yarn</span> run installPackages</code></pre></div>
<h2 id="inverting-a-matrix">Inverting a matrix</h2>
<p>There is an argument to <a href="https://news.ycombinator.com/item?id=11681893">never invert a matrix</a>—reasons being computational space time efficiency and numerical instability. However, inverting for us is an end-in-itself.</p>
<h3 id="the-identity-matrix">The identity matrix</h3>
<p>With matrices we cannot divide a matrix like say you would two numbers <code>3 / 2 = 3 * 2^(-1) = 3 * (1 / 2) = 3 / 2</code>. We can however multiply a matrix by the inverse of some matrix <code>[[...], ...] * [[...], ...]^(-1)</code> provided the inverse exists. What happens if you take a matrix <code>A</code> and times it by its inverse <code>A^(-1)</code>? You get the identity matrix <code>I = A * A^(-1)</code>. Multiply a matrix by the identity matrix and you get back the same matrix <code>A * I = A = A * (A * A^(-1)) = A * I</code>.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">[ <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]   [ <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]   [ <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ] <span class="fu">^</span> <span class="fu">-</span><span class="dv">1</span>   [ <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]   [ <span class="fl">0.5</span> <span class="dv">0</span>   <span class="dv">0</span>   <span class="dv">0</span>   ]   [ <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ] <span class="fu">=</span> [ <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span> ] <span class="fu">*</span> [ <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span> ]      <span class="fu">=</span> [ <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">0</span> ] <span class="fu">*</span> [ <span class="dv">0</span>   <span class="fl">0.5</span> <span class="dv">0</span>   <span class="dv">0</span>   ] <span class="fu">=</span> [ <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]   [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> ]   [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> ]        [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> ]   [ <span class="dv">0</span>   <span class="dv">0</span>   <span class="fl">0.5</span> <span class="dv">0</span>   ]   [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> ]   [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> ]   [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> ]        [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> ]   [ <span class="dv">0</span>   <span class="dv">0</span>   <span class="dv">0</span>   <span class="fl">0.5</span> ]   [ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> ]</code></pre></div>
<p>Notice the ones going down the diagonal. For every matrix value where the row number equals the column number notice the following.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="dv">2</span> <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="dv">0</span> <span class="op">+</span> <span class="dv">0</span> <span class="op">+</span> <span class="dv">0</span> <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> / <span class="dv">2</span>) <span class="op">+</span> <span class="dv">0</span> <span class="op">+</span> <span class="dv">0</span> <span class="op">+</span> <span class="dv">0</span> <span class="op">=</span> <span class="dv">1</span></code></pre></div>
<p>What if we took our matrix <code>A</code>, the identity matrix <code>I</code>, performed some operations on <code>A</code> to make it look just like <code>I</code>, and did those same operations on <code>I</code>? What would <code>I</code> turn into? <code>I</code> would turn into the inverse <code>A^(-1)</code> and <code>A</code> would turn into <code>I</code>.</p>
<h3 id="inverse-criteria">Inverse criteria</h3>
<p>Before we can find the inverse, we must satisfy the following criteria.</p>
<ul>
<li><code>A</code> must be square such that it has as many rows as it does columns
<ul>
<li><code>I</code> is always square</li>
</ul></li>
<li><code>A</code> cannot have a row that is all zeros and/or a column that is all zeros
<ul>
<li><code>I</code> has no rows and/or columns with all zeros</li>
</ul></li>
<li><code>A</code> must have as many <a href="https://en.wikipedia.org/wiki/Pivot_element#Pivot_position">pivot positions</a> as it does rows
<ul>
<li><code>I</code> has as many pivot positions as it does rows</li>
</ul></li>
</ul>
<p>If we notice an all zero row or column, while we turn <code>A</code> into <code>I</code>, we have to stop. Similarly, if find ourselves without a pivot position, as we traverse the rows, we have to stop. We’ll have to report back to the user that the matrix could not be inverted if we cannot satisfy all of the criteria.</p>
<h3 id="elementary-row-operations">Elementary row operations</h3>
<p>So what operations can we perform to turn <code>A</code> into <code>I</code>?</p>
<ul>
<li>Swap two rows</li>
<li>Multiply a row by some non zero number</li>
<li>Take a row, multiply it by some number, and then add that result to another row</li>
</ul>
<blockquote>
Elementary row operations are used in Gaussian elimination to reduce a matrix to row echelon form. They are also used in Gauss-Jordan elimination to further reduce the matrix to reduced row echelon form.
<footer>
<a href="https://en.wikipedia.org/wiki/Elementary_matrix#Operations">Elementary Matrix - Wikipedia</a>
</footer>
</blockquote>
<h3 id="rref">RREF</h3>
<p>Using these operations our goal is to turn every diagonal value in <code>A</code> into a one and every other value into a zero. This is known as reduced row echelon form (RREF).</p>
<p>To be in RREF, your matrix must satisfy the following.</p>
<ul>
<li>The ones (also known as the “pivots”) have to be the only non-zero number in their column</li>
<li>The pivots have to be in column order
<ul>
<li>From top to bottom, pivots in lower numbered columns come before pivots in higher numbered columns</li>
</ul></li>
<li>From left to right, all values before a pivot in a row have to be zero</li>
<li>All zero rows are at the bottom</li>
</ul>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">
<span class="dt">No</span><span class="fu">:</span>

[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ]

<span class="dt">Yes</span><span class="fu">:</span>

[ <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]

<span class="dt">No</span><span class="fu">:</span>

[ <span class="dv">3</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]

<span class="dt">Yes</span><span class="fu">:</span>

[ <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]

<span class="dt">No</span><span class="fu">:</span>

[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]

<span class="dt">Yes</span><span class="fu">:</span>

[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]

<span class="dt">No</span><span class="fu">:</span>

[ <span class="dv">1</span> <span class="dv">0</span> <span class="dv">3</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]

<span class="dt">Yes</span><span class="fu">:</span>

[ <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]
[ <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ]</code></pre></div>
<h3 id="gauss-jordan-elimination">Gauss-Jordan elimination</h3>
<p>Our algorithm for turning <code>A</code> into <code>I</code> follows the following pseudo code.</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="kw">do</span>

  let A be the input matrix
  let I be the identity matrix

  <span class="kw">if</span> A is <span class="kw">not</span> square <span class="kw">do</span>
    <span class="kw">return</span> error

  while A is <span class="kw">not</span> <span class="kw">in</span> <span class="dt">RREF</span> <span class="kw">do</span>

    <span class="kw">if</span> A contains a zero row <span class="kw">or</span> column <span class="kw">do</span>
      <span class="kw">return</span> error

    <span class="kw">in</span> A <span class="kw">and</span> <span class="kw">for</span> each diagonal value <span class="kw">do</span>

      <span class="kw">in</span> A <span class="kw">in</span> current column <span class="kw">and</span> <span class="kw">in</span> rows at <span class="kw">or</span> below current row, find the row with a one <span class="kw">or</span> the largest absolute value
      <span class="kw">in</span> A swap the found row with the current row
      <span class="kw">in</span> I swap the same row numbers

      <span class="kw">in</span> A get current diagonal value

      <span class="kw">if</span> diagonal value is zero <span class="kw">do</span>
        <span class="kw">return</span> error

      <span class="kw">in</span> A multiply pivot row by (<span class="dv">1</span> / diagonal value)
      <span class="kw">in</span> A overwrite pivot row with this new row

      <span class="kw">in</span> I multiply pivot row by (<span class="dv">1</span> / diagonal value found <span class="kw">in</span> A)
      <span class="kw">in</span> I overwrite pivot row with this new row

      <span class="kw">in</span> A <span class="kw">and</span> from top to bottom row <span class="kw">in</span> current column <span class="kw">do</span>

        <span class="kw">if</span> current row is the pivot row
          skip

        <span class="kw">in</span> A get current row column value
        <span class="kw">in</span> A get current pivot

        <span class="kw">in</span> A subtract <span class="kw">do</span>
          <span class="kw">in</span> A multiply pivot row by current row column value
        from <span class="kw">do</span>
          <span class="kw">in</span> A multiply current row by pivot
        <span class="kw">and</span> store this new row <span class="kw">in</span> current row

        <span class="kw">in</span> I subtract <span class="kw">do</span>
          <span class="kw">in</span> I multiply current row by pivot found <span class="kw">in</span> A
        from <span class="kw">do</span>
          <span class="kw">in</span> I multiply pivot row by current row column value found <span class="kw">in</span> A
        <span class="kw">and</span> store this new row <span class="kw">in</span> current row

  <span class="kw">return</span> I</code></pre></div>
<p>Overall our goal is to visit each diagonal value (row number equals column number), turn that value into a one (by dividing the whole row by the diagonal value) and zero out every other value in the column (by subtracting the pivot row multiplied by the target value from the target row multiplied by the pivot value) while also mirroring the same operations in <em>what was initially</em> the identity matrix. Note that we reuse the numbers we find in the input matrix when we perform the mirrored operations in the identity matrix. For example, if we are dividing the current row by 11 (because the diagonal was 11) in the input matrix then we will divide the same row number by 11 in the identity matrix.</p>
<p>Typically one will generate an augmented matrix by appending the identity matrix to the input matrix and then perform the elementary operations on this augmented matrix. By doing it this way you perform the mirrored operations implicitly. For our implementation though we will keep the two matrices separate while we perform the inversion calculation.</p>
<p>To make it concrete lets run through a small example.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="dt">Begin</span>

<span class="dt">A</span> <span class="fu">=</span> [ <span class="dv">0</span> <span class="dv">2</span> ]
    [ <span class="dv">2</span> <span class="dv">1</span> ]

<span class="dt">I</span> <span class="fu">=</span> [ <span class="dv">1</span> <span class="dv">0</span> ]
    [ <span class="dv">0</span> <span class="dv">1</span> ]

<span class="dt">Search</span> for a <span class="dv">1</span> or the largest number <span class="kw">in</span> <span class="dt">C1</span> at or below <span class="dt">R1</span>
<span class="dt">Found</span> <span class="dv">2</span> <span class="kw">in</span> <span class="dt">R2</span> <span class="dt">C1</span>
<span class="dt">Swap</span> <span class="dt">R1</span> with <span class="dt">R2</span> <span class="kw">in</span> <span class="dt">A</span>
<span class="dt">Swap</span> <span class="dt">R1</span> with <span class="dt">R2</span> <span class="kw">in</span> <span class="dt">I</span>

<span class="dt">A</span> <span class="fu">=</span> [ <span class="dv">2</span> <span class="dv">1</span> ]
    [ <span class="dv">0</span> <span class="dv">2</span> ]

<span class="dt">I</span> <span class="fu">=</span> [ <span class="dv">0</span> <span class="dv">1</span> ]
    [ <span class="dv">1</span> <span class="dv">0</span> ]

<span class="dt">R1</span> <span class="dt">C1</span> is not <span class="dv">1</span>
<span class="dt">Multiply</span> <span class="dt">R1</span> by (<span class="dv">1</span> <span class="fu">/</span> <span class="dv">2</span>) <span class="kw">in</span> <span class="dt">A</span>
<span class="dt">Multiply</span> <span class="dt">R1</span> by (<span class="dv">1</span> <span class="fu">/</span> <span class="dv">2</span>) <span class="kw">in</span> <span class="dt">I</span>

<span class="dt">A</span> <span class="fu">=</span> [ <span class="dv">1</span> <span class="fl">0.5</span> ]
    [ <span class="dv">0</span> <span class="dv">2</span>   ]

<span class="dt">I</span> <span class="fu">=</span> [ <span class="dv">0</span> <span class="fl">0.5</span> ]
    [ <span class="dv">1</span> <span class="dv">0</span>   ]

<span class="dt">All</span> other column values <span class="kw">in</span> <span class="dt">C1</span> are zero so move to the next diagonal

<span class="dt">A</span> <span class="fu">=</span> [ <span class="dv">1</span> <span class="fl">0.5</span> ]
    [ <span class="dv">0</span> <span class="dv">2</span>   ]

<span class="dt">I</span> <span class="fu">=</span> [ <span class="dv">0</span> <span class="fl">0.5</span> ]
    [ <span class="dv">1</span> <span class="dv">0</span>   ]

<span class="dt">R2</span> <span class="dt">C2</span> is not <span class="dv">1</span>
<span class="dt">Multiply</span> <span class="dt">R2</span> by (<span class="dv">1</span> <span class="fu">/</span> <span class="dv">2</span>) <span class="kw">in</span> <span class="dt">A</span>
<span class="dt">Multiply</span> <span class="dt">R2</span> by (<span class="dv">1</span> <span class="fu">/</span> <span class="dv">2</span>) <span class="kw">in</span> <span class="dt">I</span>

<span class="dt">A</span> <span class="fu">=</span> [ <span class="dv">1</span> <span class="fl">0.5</span> ]
    [ <span class="dv">0</span> <span class="dv">1</span>   ]

<span class="dt">I</span> <span class="fu">=</span> [ <span class="dv">0</span>   <span class="fl">0.5</span> ]
    [ <span class="fl">0.5</span> <span class="dv">0</span>   ]

<span class="dt">R1</span> <span class="dt">C2</span> is not zero
<span class="dt">Multiply</span> <span class="dt">R1</span> by <span class="dv">1</span> <span class="kw">in</span> <span class="dt">A</span>
<span class="dt">Multiply</span> <span class="dt">R2</span> by <span class="fl">0.5</span> <span class="kw">in</span> <span class="dt">A</span>
<span class="dt">Subtract</span> and overwrite <span class="dt">R1</span> <span class="kw">in</span> <span class="dt">A</span>
<span class="dt">R1</span> <span class="fu">=</span> <span class="dv">1</span> <span class="fu">*</span> <span class="dt">R1</span> <span class="fu">-</span> <span class="fl">0.5</span> <span class="fu">*</span> <span class="dt">R2</span>
<span class="dt">R1</span> <span class="fu">=</span> <span class="dv">1</span> <span class="fu">*</span> [ <span class="dv">1</span> <span class="fl">0.5</span> ] <span class="fu">-</span> <span class="fl">0.5</span> [ <span class="dv">0</span> <span class="dv">1</span> ]
<span class="dt">R1</span> <span class="fu">=</span> [<span class="dv">1</span> <span class="fl">0.5</span> ] <span class="fu">-</span> [ <span class="dv">0</span> <span class="fl">0.5</span> ]
<span class="dt">R1</span> <span class="fu">=</span> [ (<span class="dv">1</span> <span class="fu">-</span> <span class="dv">0</span>) (<span class="fl">0.5</span> <span class="fu">-</span> <span class="fl">0.5</span>) ]
<span class="dt">R1</span> <span class="fu">=</span> [ <span class="dv">1</span> <span class="dv">0</span> ]
<span class="dt">Multiply</span> <span class="dt">R1</span> by <span class="dv">1</span> <span class="kw">in</span> <span class="dt">I</span>
<span class="dt">Multiply</span> <span class="dt">R2</span> by <span class="fl">0.5</span> <span class="kw">in</span> <span class="dt">I</span>
<span class="dt">Subtract</span> and overwrite <span class="dt">R1</span> <span class="kw">in</span> <span class="dt">I</span>
<span class="dt">R1</span> <span class="fu">=</span> <span class="dv">1</span> <span class="fu">*</span> <span class="dt">R1</span> <span class="fu">-</span> <span class="fl">0.5</span> <span class="fu">*</span> <span class="dt">R2</span>
<span class="dt">R1</span> <span class="fu">=</span> <span class="dv">1</span> <span class="fu">*</span> [ <span class="dv">0</span> <span class="fl">0.5</span> ] <span class="fu">-</span> <span class="fl">0.5</span> [ <span class="fl">0.5</span> <span class="dv">0</span> ]
<span class="dt">R1</span> <span class="fu">=</span> [ <span class="dv">0</span> <span class="fl">0.5</span> ] <span class="fu">-</span> [ <span class="fl">0.25</span> <span class="dv">0</span> ]
<span class="dt">R1</span> <span class="fu">=</span> [ (<span class="dv">0</span> <span class="fu">-</span> <span class="fl">0.25</span>) (<span class="fl">0.5</span> <span class="fu">-</span> <span class="dv">0</span>) ]
<span class="dt">R1</span> <span class="fu">=</span> [ <span class="fu">-</span><span class="fl">0.25</span> <span class="fl">0.5</span> ]

<span class="dt">A</span> <span class="fu">=</span> [ <span class="dv">1</span> <span class="dv">0</span> ]
    [ <span class="dv">0</span> <span class="dv">1</span> ]

<span class="dt">I</span> <span class="fu">=</span> [ <span class="fu">-</span><span class="fl">0.25</span> <span class="fl">0.5</span> ]
    [  <span class="fl">0.5</span>  <span class="dv">0</span>   ]

<span class="dt">All</span> other non<span class="fu">-</span>pivot column values <span class="kw">in</span> <span class="dt">C2</span> are zero so move to the next diagonal
<span class="dt">No</span> other diagonals
<span class="dt">A</span> is now the identity matrix
<span class="dt">Stop</span>
<span class="dt">Test</span>

[ <span class="dv">0</span> <span class="dv">2</span> ] <span class="fu">*</span> [ <span class="fu">-</span><span class="fl">0.25</span> <span class="fl">0.5</span> ] <span class="fu">=</span> [ (<span class="dv">0</span> <span class="fu">*</span> <span class="fu">-</span><span class="fl">0.25</span> <span class="fu">+</span> <span class="dv">2</span> <span class="fu">*</span> <span class="fl">0.5</span>) (<span class="dv">0</span> <span class="fu">*</span> <span class="fl">0.5</span> <span class="fu">+</span> <span class="dv">2</span> <span class="fu">*</span> <span class="dv">0</span>) ] <span class="fu">=</span> [ <span class="dv">1</span> <span class="dv">0</span> ]
[ <span class="dv">2</span> <span class="dv">1</span> ]   [  <span class="fl">0.5</span>  <span class="dv">0</span>   ]   [ (<span class="dv">2</span> <span class="fu">*</span> <span class="fu">-</span><span class="fl">0.25</span> <span class="fu">+</span> <span class="dv">1</span> <span class="fu">*</span> <span class="fl">0.5</span>) (<span class="dv">2</span> <span class="fu">*</span> <span class="fl">0.5</span> <span class="fu">+</span> <span class="dv">1</span> <span class="fu">*</span> <span class="dv">0</span>) ]   [ <span class="dv">0</span> <span class="dv">1</span> ]</code></pre></div>
<h2 id="application-code">Application code</h2>
<p>Our project is setup and we have our basic algorithm ready. We can now begin developing our application in PureScript, HTML, and Sass.</p>
<h3 id="html">HTML</h3>
<p>While we will define some of our HTML in PureScript, we can generate the page shell by hand.</p>
<p>Make sure to open up your favorite text editor and replace <code>static/html/index.html</code> with the following code.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="co">&lt;!--(C) 2017 David Lettier--&gt;</span>
<span class="kw">&lt;html&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;title&gt;</span>Matrix Inverse Calculator | Lettier.com<span class="kw">&lt;/title&gt;</span>
    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;index.css&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;pageContainer&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;instructionsContainer&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;h1&gt;</span>Matrix Inverse Calculator<span class="kw">&lt;/h1&gt;</span>
      <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;row&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;uiContainer&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;app.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></div>
<p>Our generated JavaScript from PureScript will be in the <code>app.js</code> file.</p>
<h3 id="sass">Sass</h3>
<p>We will use the CSS pre-processor, Sass, to give our calculator some style.</p>
<p>Make sure to open up your favorite text editor and replace <code>static/scss/index.scss</code> with the following code.</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css"><span class="co">/*</span>
<span class="co">  (C) 2017 David Lettier</span>
<span class="co">  lettier.com</span>
<span class="co">*/</span>

$laptopLWidth<span class="dv">:</span> 1440px;
$laptopWidth<span class="dv">:</span> 1024px;
$tabletWidth<span class="dv">:</span> 768px;

$color1<span class="dv">:</span> rgba(51, 55, 69, 1);
$color2<span class="dv">:</span> rgba(245, 47, 87, 1);
$color3<span class="dv">:</span> rgba(76, 75, 99, 1);
$color4<span class="dv">:</span> rgba(175, 190, 209, 1);
$color5<span class="dv">:</span> rgba(237, 237, 244, 1);

$matrixValueInputSize<span class="dv">:</span> 45px;

@mixin laptopL <span class="kw">{</span>
  <span class="er">@media</span> <span class="er">(</span><span class="kw">max-width:</span> #{$laptopLWidth<span class="kw">}</span>) <span class="kw">{</span>
    <span class="er">@content;</span>
  <span class="kw">}</span>
}

@mixin laptop <span class="kw">{</span>
  <span class="er">@media</span> <span class="er">(</span><span class="kw">max-width:</span> #{$laptopWidth<span class="kw">}</span>) <span class="kw">{</span>
    <span class="er">@content;</span>
  <span class="kw">}</span>
}

@mixin tablet <span class="kw">{</span>
  <span class="er">@media</span> <span class="er">(</span><span class="kw">max-width:</span> #{$tabletWidth<span class="kw">}</span>) <span class="kw">{</span>
    <span class="er">@content;</span>
  <span class="kw">}</span>
}

body <span class="kw">{</span>
  <span class="kw">font-family:</span> <span class="dt">sans-serif</span><span class="kw">;</span>
  <span class="kw">margin-top:</span>   <span class="dt">25px</span><span class="kw">;</span>
  <span class="kw">margin-left:</span> <span class="dt">25px</span><span class="kw">;</span>
  <span class="kw">background-color:</span> <span class="dt">#343438</span><span class="kw">;</span>
  <span class="kw">color:</span> <span class="dt">white</span><span class="kw">;</span>
  <span class="kw">height:</span> <span class="dt">100%</span><span class="kw">;</span>
  <span class="kw">line-height:</span> <span class="dt">2</span><span class="kw">;</span>
<span class="kw">}</span>
input <span class="kw">{</span>
  <span class="kw">margin-right:</span> <span class="dt">4px</span><span class="kw">;</span>
  <span class="kw">outline:</span> <span class="dt">none</span><span class="kw">;</span>
  <span class="kw">border:</span> <span class="dt">none</span><span class="kw">;</span>
  <span class="kw">border-radius:</span> <span class="dt">1px</span><span class="kw">;</span>
  <span class="kw">padding:</span> <span class="dt">2px</span><span class="kw">;</span>
  <span class="kw">font-size:</span> <span class="dt">20px</span><span class="kw">;</span>
  <span class="kw">background-color:</span> whitesmoke<span class="kw">;</span>
  <span class="kw">color:</span> <span class="dt">#222</span><span class="kw">;</span>
<span class="kw">}</span>
li <span class="kw">{</span>
  <span class="kw">list-style:</span> <span class="dt">none</span><span class="kw">;</span>
  <span class="kw">margin-top:</span> <span class="dt">3px</span><span class="kw">;</span>
<span class="kw">}</span>
button <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#6f6cb9</span><span class="kw">;</span>
  <span class="kw">color:</span> <span class="dt">white</span><span class="kw">;</span>
  <span class="kw">font-weight:</span> <span class="dt">bold</span><span class="kw">;</span>
  <span class="kw">margin:</span> <span class="dt">2px</span><span class="kw">;</span>
  <span class="kw">border-style:</span> <span class="dt">none</span><span class="kw">;</span>
  <span class="kw">border-radius:</span> <span class="dt">1px</span><span class="kw">;</span>
  <span class="kw">outline:</span> <span class="dt">none</span><span class="kw">;</span>
  <span class="kw">font-size:</span> <span class="dt">20px</span><span class="kw">;</span>
  <span class="kw">cursor:</span> <span class="dt">pointer</span><span class="kw">;</span>
  <span class="kw">-webkit-box-shadow:</span> <span class="dt">0px</span> <span class="dt">3px</span> <span class="dt">3px</span> <span class="dt">0px</span> <span class="dt">#190d25</span><span class="kw">;</span>
  <span class="kw">-moz-box-shadow:</span>    <span class="dt">0px</span> <span class="dt">3px</span> <span class="dt">3px</span> <span class="dt">0px</span> <span class="dt">#190d25</span><span class="kw">;</span>
  <span class="kw">box-shadow:</span>         <span class="dt">0px</span> <span class="dt">3px</span> <span class="dt">3px</span> <span class="dt">0px</span> <span class="dt">#190d25</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">#pageContainer</span> <span class="kw">{</span>
  <span class="kw">height:</span> <span class="dt">100%</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">#chartContainer</span> <span class="kw">{</span>
  <span class="kw">margin-right:</span> <span class="dt">10px</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">#instructionsContainer</span> <span class="kw">{</span>
  <span class="kw">margin-bottom:</span> <span class="dt">20px</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">#uiContainer</span> <span class="kw">{</span>
  <span class="kw">margin-left:</span> <span class="dt">10px</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.status</span> <span class="kw">{</span>
  <span class="kw">display:</span> <span class="dt">block</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.matrixSizeInput</span> <span class="kw">{</span>
  <span class="kw">width:</span> <span class="dt">300px</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.matricesContainer</span> <span class="kw">{</span>
  <span class="kw">display:</span> flex<span class="kw">;</span>
  <span class="kw">margin-top:</span> <span class="dt">10px</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.matrixAContainer</span> input <span class="kw">{</span>
<span class="kw">}</span>
<span class="fl">.matrixBContainer</span> <span class="kw">{</span>
  <span class="kw">margin-left:</span> <span class="dt">10px</span><span class="kw">;</span>
  <span class="kw">padding-left:</span> <span class="dt">10px</span><span class="kw">;</span>
  <span class="kw">border-left:</span> <span class="dt">1px</span> <span class="dt">solid</span> <span class="dt">white</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.identityContainer</span> input <span class="kw">{</span>
<span class="kw">}</span>
<span class="fl">.matrixRow</span> <span class="kw">{</span>
  <span class="kw">display:</span> flex<span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.matrixValueInput</span> <span class="kw">{</span>
  <span class="kw">width:</span>  $matrixValueInputSize<span class="kw">;</span>
  <span class="kw">height:</span> $matrixValueInputSize<span class="kw">;</span>
  <span class="kw">margin:</span> <span class="dt">1px</span><span class="kw">;</span>
  <span class="kw">text-align:</span> <span class="dt">center</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.runButton</span> <span class="kw">{</span>
  <span class="kw">display:</span> <span class="dt">inline-block</span><span class="kw">;</span>
  <span class="kw">background-color:</span> <span class="dt">#00c17c</span><span class="kw">;</span>
  <span class="kw">margin-left:</span> <span class="dt">10px</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.removeButton</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#f52f57</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.defaultCursor</span> <span class="kw">{</span>
  <span class="kw">cursor:</span> <span class="dt">default</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.row</span> <span class="kw">{</span>
  <span class="kw">display:</span> flex<span class="kw">;</span>
  <span class="kw">flex-direction:</span> row<span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.blue</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#6b89e0</span><span class="kw">;</span>
  <span class="kw">color:</span> <span class="dt">white</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.lightBlue</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#99b3ff</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.red</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#dc5c90</span><span class="kw">;</span>
  <span class="kw">color:</span> <span class="dt">white</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">.lightRed</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#ff86b7</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></div>
<p>The <code>node-sass static/scss/index.scss dist/index.css</code> command in <code>package.json</code> will convert our Sass to CSS.</p>
<h3 id="purescript">PureScript</h3>
<p>We will be using PureScript to program the logic of our application.</p>
<blockquote>
PureScript is a small strongly typed programming language that compiles to JavaScript.
<footer>
<a href="http://purescript.org">PureScript.org</a>
</footer>
</blockquote>
<p>The following files make up all of the PureScript code for our matrix inverse calculator.</p>
<h4 id="matrixinverse.purs">MatrixInverse.purs</h4>
<p>We will start with <code>MatrixInverse.purs</code>. This file or module contains all of our matrix related functions for inverting a matrix.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">MatrixInverse</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Prelude</span>

<span class="kw">import </span><span class="dt">Data.Ord</span> (abs)
<span class="kw">import </span><span class="dt">Data.Foldable</span> (foldl)
<span class="kw">import </span><span class="dt">Data.Tuple</span> (<span class="dt">Tuple</span>(..), fst, snd)
<span class="kw">import </span><span class="dt">Data.Array</span> (head, length, null, range, slice, tail, updateAt, zip, (!!))
<span class="kw">import </span><span class="dt">Data.Either</span> (<span class="dt">Either</span>(..))
<span class="kw">import </span><span class="dt">Data.Maybe</span> (<span class="dt">Maybe</span>(<span class="dt">Just</span>, <span class="dt">Nothing</span>), fromMaybe, isNothing)</code></pre></div>
<p>The top section defines the module and imports all of the necessary dependencies. The PureScript compiler will warn us if we are importing something we don’t need. It will also throw an error if we are using something we didn’t explicitly import. This can get tedious as PureScript’s package ecosystem is very granular.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">defaultMatrix ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
defaultMatrix size <span class="fu">=</span> buildMatrix size value
  <span class="kw">where</span>
    value _ _ <span class="fu">=</span> defaultMatrixValue

<span class="ot">identityMatrix ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
identityMatrix size <span class="fu">=</span> buildMatrix size value
  <span class="kw">where</span>
    value row col <span class="fu">|</span> row <span class="fu">==</span> col <span class="fu">=</span> <span class="fl">1.0</span>
                  <span class="fu">|</span> otherwise   <span class="fu">=</span> <span class="fl">0.0</span>

<span class="ot">buildMatrix ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> (<span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span>) <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
buildMatrix <span class="dv">0</span>    _ <span class="fu">=</span> []
buildMatrix size f <span class="fu">=</span> map (\ row <span class="ot">-&gt;</span> map (\ col <span class="ot">-&gt;</span> f row col) matrixRange) matrixRange
  <span class="kw">where</span>
    matrixRange <span class="fu">=</span> range <span class="dv">0</span> (size <span class="fu">-</span> <span class="dv">1</span>)

<span class="co">-- ...</span>

<span class="ot">defaultMatrixValue ::</span> <span class="dt">Number</span>
defaultMatrixValue <span class="fu">=</span> <span class="fl">0.0</span></code></pre></div>
<p><code>defaultMatrix</code> inputs a number and outputs a square matrix of the given size using the <code>buildMatrix</code> function. Every value in the matrix will be <code>0.0</code> as given by <code>defaultMatrixValue</code>.</p>
<p>The <code>identityMatrix</code> function takes a size and outputs a square matrix that is zeros everywhere except when the <code>row</code> and <code>col</code> numbers match. You can see that logic in the <code>where</code> clause.</p>
<p><code>buildMatrix</code> takes a size, a function that takes two integers and outputs a number, and outputs a matrix. The input function is used to fill each value in the matrix being built. We map over the rows and map over the columns and for each row and column we fill the value by passing the row and column number to the function that was passed to <code>buildMatrix</code>. Since we only care about building square matrices, we use the same range for both rows and columns.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">containsZeroRowOrCol ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
containsZeroRowOrCol matrix <span class="fu">=</span> containsZeroRow matrix <span class="fu">||</span> containsZeroCol matrix

<span class="ot">containsZeroCol ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
containsZeroCol <span class="fu">=</span> containsZeroRow <span class="fu">&lt;&lt;&lt;</span> transpose

<span class="ot">containsZeroRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
containsZeroRow <span class="fu">=</span> foldl (\ acc row <span class="ot">-&gt;</span> acc <span class="fu">||</span> foldl (\ acc' value <span class="ot">-&gt;</span> acc' <span class="fu">&amp;&amp;</span> value <span class="fu">==</span> <span class="fl">0.0</span>) true row) false

<span class="ot">isSquareMatrix ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
isSquareMatrix matrix <span class="fu">=</span> foldl (\ acc row <span class="ot">-&gt;</span> acc <span class="fu">&amp;&amp;</span> length row <span class="fu">==</span> matrixLength) true matrix
  <span class="kw">where</span>
    matrixLength <span class="fu">=</span> length matrix</code></pre></div>
<p>Here we define some error checking functions. You’ll remember that our input matrix must be square and have no rows and/or columns that contain all zeros.</p>
<p><code>isSquareMatrix</code> checks that every row of the matrix has the same number of elements as the number of rows in the matrix. If one or more rows are longer or shorter than the total amount of rows, we output false. Otherwise, if they have all the same size, we output true.</p>
<p><code>containsZeroRow</code> reduces (<code>foldl</code> for fold from the left) the input matrix down to a single Boolean (true or false) value. For every row, we check if all the values contain zero and if so, we return true for that row. As we reduce each row down to a Boolean, we or (<code>||</code>) these together and output true or false. If one or more rows have all zeros, our output will be true and otherwise it will be false.</p>
<p><code>containsZeroCol</code> transposes the input matrix (turns every column into a row) and then uses <code>containsZeroRow</code> to check for any row (previously a column) that contains all zeros.</p>
<p>So for example, take a look at the following.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">input

  [  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span> <span class="dv">0</span> ]
  [  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span> <span class="dv">0</span> ]
  [  <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">0</span> ]
  [ <span class="dv">13</span> <span class="dv">14</span> <span class="dv">15</span> <span class="dv">0</span> ]

transpose

  [  <span class="dv">1</span>  <span class="dv">5</span>  <span class="dv">9</span> <span class="dv">13</span> ]
  [  <span class="dv">2</span>  <span class="dv">6</span> <span class="dv">10</span> <span class="dv">14</span> ]
  [  <span class="dv">3</span>  <span class="dv">7</span> <span class="dv">11</span> <span class="dv">15</span> ]
  [  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">0</span> ]

reduce

  [  <span class="dv">1</span>  <span class="dv">5</span>  <span class="dv">9</span> <span class="dv">13</span> ] <span class="dt">False</span> \ <span class="dt">False</span> \
  [  <span class="dv">2</span>  <span class="dv">6</span> <span class="dv">10</span> <span class="dv">14</span> ] <span class="dt">False</span> <span class="fu">/</span>         <span class="dt">True</span>
  [  <span class="dv">3</span>  <span class="dv">7</span> <span class="dv">11</span> <span class="dv">15</span> ] <span class="dt">False</span> \ <span class="dt">True</span>  <span class="fu">/</span>
  [  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">0</span> ] <span class="dt">True</span>  <span class="fu">/</span></code></pre></div>
<p>Recall that once we visit a new diagonal, we have to find the best row to pivot off of. The best is a row (in the same column as the diagonal) with a one but if we cannot find that then we pick the row that has the largest absolute value among the column of values. Note that the only row column values we can look at are the values at or below the current row number of the diagonal we are at. We do not want to swap with any rows above the current since we already pivoted off of those rows.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="dt">C1</span> <span class="dt">C2</span> <span class="dt">C3</span> <span class="dt">C4</span>
[ <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span> ] <span class="dt">R1</span>
[ <span class="dv">0</span> (<span class="dv">0</span>) <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R2</span>
[ <span class="dv">0</span>  <span class="dv">2</span>  <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R3</span>
[ <span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R4</span></code></pre></div>
<p>Let’s say we are at the R2 C2 diagonal.</p>
<p>In this case the first valid row would be R4 since it contains a one in the same column as the diagonal. We would end up swapping R2 with R4.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="dt">C1</span> <span class="dt">C2</span> <span class="dt">C3</span> <span class="dt">C4</span>
[ <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span> ] <span class="dt">R1</span>
[ <span class="dv">0</span> (<span class="dv">1</span>) <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R2</span>
[ <span class="dv">0</span>  <span class="dv">8</span>  <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R3</span>
[ <span class="dv">0</span>  <span class="dv">9</span>  <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R4</span></code></pre></div>
<p>In this case the first valid row would be R2 since it contains a one in the same column as the diagonal. We would end up swapping R2 with R2.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="dt">C1</span> <span class="dt">C2</span> <span class="dt">C3</span> <span class="dt">C4</span>
[ <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">1</span> ] <span class="dt">R1</span>
[ <span class="dv">0</span> (<span class="dv">2</span>) <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R2</span>
[ <span class="dv">0</span> <span class="fu">-</span><span class="dv">4</span>  <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R3</span>
[ <span class="dv">0</span>  <span class="dv">3</span>  <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R4</span></code></pre></div>
<p>In this case the first valid row would be R3 since it contains a negative four in the same column as the diagonal. We would end up swapping R2 with R3.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">firstValidRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Int</span>
firstValidRow []     _            _     <span class="fu">=</span> <span class="dt">Nothing</span>
firstValidRow matrix atRowOrBelow inCol <span class="fu">=</span> (foldl folder { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span>} tuples)<span class="fu">.</span>index
  <span class="kw">where</span>
    matrixLength <span class="fu">=</span> length matrix
    lastRow <span class="fu">=</span> matrixLength <span class="fu">-</span> <span class="dv">1</span>
    rowRange <span class="fu">=</span> range atRowOrBelow lastRow
    column <span class="fu">=</span> slice atRowOrBelow matrixLength (matrixRow (transpose matrix) inCol)
    tuples <span class="fu">=</span> zip rowRange column
<span class="ot">    folder ::</span> {<span class="ot"> index ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>,<span class="ot"> value ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> } <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> {<span class="ot"> index ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>,<span class="ot"> value ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> }
    folder { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span>} (<span class="dt">Tuple</span> a b) <span class="fu">=</span> { index<span class="fu">:</span> (<span class="dt">Just</span> a), value<span class="fu">:</span> (<span class="dt">Just</span> b) }
    folder r<span class="fu">@</span>{ index<span class="fu">:</span> (<span class="dt">Just</span> x), value<span class="fu">:</span> (<span class="dt">Just</span> y)} (<span class="dt">Tuple</span> a b) <span class="fu">=</span>
      <span class="kw">if</span> abs y <span class="fu">==</span> <span class="fl">1.0</span>
        <span class="kw">then</span> r
        <span class="kw">else</span>
          <span class="kw">if</span> abs b <span class="fu">&gt;=</span> abs y <span class="fu">||</span> abs b <span class="fu">==</span> <span class="fl">1.0</span>
            <span class="kw">then</span> { index<span class="fu">:</span> (<span class="dt">Just</span> a), value<span class="fu">:</span> (<span class="dt">Just</span> b) }
            <span class="kw">else</span> r
    folder _ _ <span class="fu">=</span> { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span> }</code></pre></div>
<p>Looking at the function you can see how we go about doing this. We input our matrix, the row and column we can start searching from, and we <code>Maybe</code> return an integer. The <code>Maybe</code> signifies that we may not find any valid row forcing us to return <code>Nothing</code>.</p>
<p>This function looks verbose but really the meat of it is in the helper function <code>folder</code>. We scan the values from <code>atRowOrBelow</code> in the column <code>inCol</code> and search for a one or the <code>abs</code> largest value. If found, we return <code>Just</code> the row number and <code>Just</code> the row column value for the first valid row.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    folder ::</span> {<span class="ot"> index ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>,<span class="ot"> value ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> } <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> {<span class="ot"> index ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>,<span class="ot"> value ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> }

    folder { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span>} (<span class="dt">Tuple</span> a b) <span class="fu">=</span> { index<span class="fu">:</span> (<span class="dt">Just</span> a), value<span class="fu">:</span> (<span class="dt">Just</span> b) }

    folder r<span class="fu">@</span>{ index<span class="fu">:</span> (<span class="dt">Just</span> x), value<span class="fu">:</span> (<span class="dt">Just</span> y)} (<span class="dt">Tuple</span> a b) <span class="fu">=</span>
      <span class="kw">if</span> abs y <span class="fu">==</span> <span class="fl">1.0</span>
        <span class="kw">then</span> r
        <span class="kw">else</span>
          <span class="kw">if</span> abs b <span class="fu">&gt;=</span> abs y <span class="fu">||</span> abs b <span class="fu">==</span> <span class="fl">1.0</span>
            <span class="kw">then</span> { index<span class="fu">:</span> (<span class="dt">Just</span> a), value<span class="fu">:</span> (<span class="dt">Just</span> b) }
            <span class="kw">else</span> r

    folder _ _ <span class="fu">=</span> { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span> }</code></pre></div>
<p>Looking closer at <code>folder</code>, it takes a record, a tuple containing an integer and a real number, and returns a record that holds maybe an integer (<code>index</code>) and maybe a real number (<code>value</code>). There a three input scenarios <code>folder</code> <em>pattern matches</em> on.</p>
<ul>
<li>The input record has nothing
<ul>
<li>Return a record containing just what the input tuple had</li>
</ul></li>
<li>The input record has values
<ul>
<li>Return the input record if its value is 1, otherwise
<ul>
<li>return the input record if its value is greater than the value of the input tuple or</li>
<li>return the tuple as a record if its value is greater than that of the input record</li>
</ul></li>
</ul></li>
<li>For everything else
<ul>
<li>return a record containing <code>Nothing</code></li>
</ul></li>
</ul>
<p>The <code>foldl</code> uses <code>folder</code> to reduce the extracted tuples, from the matrix column, down to a single record where we access the index or row number that <code>Maybe</code> an integer if <code>folder</code> was able to find something.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">input matrix

    <span class="dt">C1</span>  <span class="dt">C2</span>  <span class="dt">C3</span> <span class="dt">C4</span>
  [ <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>  <span class="dv">1</span> ] <span class="dt">R1</span>
  [ <span class="dv">0</span> [(<span class="dv">2</span>)] <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R2</span>
  [ <span class="dv">0</span> [<span class="fu">-</span><span class="dv">4</span> ] <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R3</span>
  [ <span class="dv">0</span> [ <span class="dv">3</span> ] <span class="dv">1</span>  <span class="dv">1</span> ] <span class="dt">R4</span>

extract tuples

  return [(<span class="dt">R2</span>, <span class="dv">2</span>), (<span class="dt">R3</span>, <span class="fu">-</span><span class="dv">4</span>), (<span class="dt">R4</span>, <span class="dv">3</span>)]

fold <span class="dv">1</span> { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span> }, (<span class="dt">R2</span>, <span class="dv">2</span>)

  return { index<span class="fu">:</span> <span class="dt">Just</span> <span class="dt">R2</span>, value<span class="fu">:</span> <span class="dt">Just</span> <span class="dv">2</span> }

fold <span class="dv">2</span> { index<span class="fu">:</span> <span class="dt">Just</span> <span class="dt">R2</span>, value<span class="fu">:</span> <span class="dt">Just</span> <span class="dv">2</span> },  (<span class="dt">R3</span>, <span class="fu">-</span><span class="dv">4</span>)

  return { index<span class="fu">:</span> <span class="dt">Just</span> <span class="dt">R3</span>, value<span class="fu">:</span> <span class="dt">Just</span> <span class="fu">-</span><span class="dv">4</span> }

fold <span class="dv">3</span> { index<span class="fu">:</span> <span class="dt">Just</span> <span class="dt">R3</span>, value<span class="fu">:</span> <span class="dt">Just</span> <span class="fu">-</span><span class="dv">4</span> }, (<span class="dt">R4</span>, <span class="dv">3</span>)

  return { index<span class="fu">:</span> <span class="dt">Just</span> <span class="dt">R3</span>, value<span class="fu">:</span> <span class="dt">Just</span> <span class="fu">-</span><span class="dv">4</span> }

return <span class="dt">Just</span> <span class="dt">R3</span></code></pre></div>
<p>Given the input matrix, we extract out the rest of the column into tuples where the first element is the row number and the second element is the value. We then reduce these tuples to a single record where we return the index attribute.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">multiplyRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
multiplyRow []     _   _          <span class="fu">=</span> []
multiplyRow matrix row multiplier <span class="fu">=</span> map (\ row' <span class="ot">-&gt;</span>
    <span class="kw">if</span> row <span class="fu">==</span> row'
      <span class="kw">then</span> map (\ value <span class="ot">-&gt;</span> value <span class="fu">*</span> multiplier) (matrixRow matrix row')
      <span class="kw">else</span> matrixRow matrix row'
  ) (matrixToRange matrix)</code></pre></div>
<p><code>multiplyRow</code> takes a matrix, row number, multiplier, and returns the modified matrix. We will use this function to turn every diagonal value into one.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">clearValue ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
clearValue (<span class="dt">Tuple</span> aMat bMat) pivot<span class="fu">@</span>(<span class="dt">Tuple</span> pRow pCol) target<span class="fu">@</span>(<span class="dt">Tuple</span> tRow tCol) <span class="fu">=</span> <span class="dt">Tuple</span> aMat' bMat'
  <span class="kw">where</span>
<span class="ot">    pivotRowA ::</span> <span class="dt">MatrixRow</span>
    pivotRowA         <span class="fu">=</span> matrixRow aMat pRow
<span class="ot">    targetRowA ::</span> <span class="dt">MatrixRow</span>
    targetRowA        <span class="fu">=</span> matrixRow aMat tRow
<span class="ot">    pivotValueA ::</span> <span class="dt">Number</span>
    pivotValueA       <span class="fu">=</span> rowValue pivotRowA pCol
<span class="ot">    targetValueA ::</span> <span class="dt">Number</span>
    targetValueA      <span class="fu">=</span> rowValue targetRowA tCol
<span class="ot">    aMat' ::</span> <span class="dt">Matrix</span>
    aMat'             <span class="fu">=</span> multiplyAndSubtractRows aMat tRow pRow pivotValueA targetValueA
<span class="ot">    bMat' ::</span> <span class="dt">Matrix</span>
    bMat'             <span class="fu">=</span> multiplyAndSubtractRows bMat tRow pRow pivotValueA targetValueA
<span class="ot">    rowValue ::</span> <span class="dt">MatrixRow</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span>
    rowValue row col  <span class="fu">=</span> fromMaybe defaultMatrixValue (row  <span class="fu">!!</span> col)
<span class="ot">    multiplyAndSubtractRows ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
    multiplyAndSubtractRows
      matrix
      leftSideRow
      rightSideRow
      leftMultiplier
      rightMultiplier
      <span class="fu">=</span> map (\ row <span class="ot">-&gt;</span> <span class="kw">if</span> row <span class="fu">==</span> leftSideRow
                        <span class="kw">then</span> leftRowValues'
                        <span class="kw">else</span> matrixRow matrix row
        ) (matrixToRange matrix)
      <span class="kw">where</span>
        leftRowValues  <span class="fu">=</span> matrixRow matrix leftSideRow
        rightRowValues <span class="fu">=</span> matrixRow matrix rightSideRow
        leftRowValues' <span class="fu">=</span> map (\ (<span class="dt">Tuple</span> l r) <span class="ot">-&gt;</span>
            leftMultiplier <span class="fu">*</span> l <span class="fu">-</span> rightMultiplier <span class="fu">*</span> r
          ) (zip leftRowValues rightRowValues)

<span class="ot">clearColumnExceptPivot ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
clearColumnExceptPivot t<span class="fu">@</span>(<span class="dt">Tuple</span> aMat bMat) pivot<span class="fu">@</span>(<span class="dt">Tuple</span> pRow pCol) <span class="fu">=</span> t'
  <span class="kw">where</span>
<span class="ot">    t' ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
    t' <span class="fu">=</span> foldl folder t (matrixToRange aMat)
<span class="ot">    folder ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
    folder acc<span class="fu">@</span>(<span class="dt">Tuple</span> aMat' bMat') row <span class="fu">=</span>
      <span class="kw">if</span> row <span class="fu">==</span> pRow
        <span class="kw">then</span> acc
        <span class="kw">else</span> clearValue acc pivot (<span class="dt">Tuple</span> row pCol)</code></pre></div>
<p><code>clearColumnExceptPivot</code> will helps up clear a column to all zeros except the diagonal value. It works on two matrices at a time mirroring the operations on <code>aMat</code> in <code>bMat</code> (<code>mat</code> short for matrix). The majority of the work occurs in <code>clearValue</code>.</p>
<p><code>clearValue</code> takes a tuple containing two matrices, a tuple of two integers, another tuple of two integers, and returns a tuple containing two matrices. While <code>clearValue</code> may look complicated at first, it is simply performing the <code>Target Row = (Pivot * Target Row) - (Target Value * Pivot Row)</code> update step. This occurs in the <code>multiplyAndSubtractRows</code> function. The rest is mostly accessing row values.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">invertMatrix ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
invertMatrix matrix
  <span class="fu">|</span> null matrix                 <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Empty matrix&quot;</span>)                (identityMatrix (length matrix))
  <span class="fu">|</span> not <span class="fu">$</span> isSquareMatrix matrix <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Not a square matrix&quot;</span>)         (identityMatrix (length matrix))
  <span class="fu">|</span> containsZeroRowOrCol matrix <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Contains zero row or column&quot;</span>) (identityMatrix (length matrix))
  <span class="fu">|</span> otherwise <span class="fu">=</span> result
  <span class="kw">where</span>
    matrixSize <span class="fu">=</span> length matrix
    identity   <span class="fu">=</span> identityMatrix matrixSize
<span class="ot">    result ::</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
    result <span class="fu">=</span> foldl folder (<span class="dt">Tuple</span> (<span class="dt">Right</span> matrix) identity) (matrixToRange matrix)
<span class="ot">    folder ::</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
    folder t<span class="fu">@</span>(<span class="dt">Tuple</span> acc<span class="fu">@</span>(<span class="dt">Left</span>  _) _) _        <span class="fu">=</span> t
    folder t<span class="fu">@</span>(<span class="dt">Tuple</span> acc<span class="fu">@</span>(<span class="dt">Right</span> a) b) diagonal <span class="fu">=</span>
      <span class="kw">if</span> containsZeroRowOrCol a <span class="fu">||</span> null a <span class="fu">||</span> isNothing maybeDivisorA <span class="fu">||</span> divisorA <span class="fu">==</span> <span class="fl">0.0</span>
        <span class="kw">then</span> (<span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Cannot invert&quot;</span>) b)
        <span class="kw">else</span> (<span class="dt">Tuple</span> (<span class="dt">Right</span> clearedA) clearedB)
      <span class="kw">where</span>
        swapped       <span class="fu">=</span> swapWithValidRow (<span class="dt">Tuple</span> a b) diagonal
        swappedA      <span class="fu">=</span> fst swapped
        swappedB      <span class="fu">=</span> snd swapped
        divisorRowA   <span class="fu">=</span> fromMaybe [] (swappedA <span class="fu">!!</span> diagonal)
        maybeDivisorA <span class="fu">=</span> divisorRowA <span class="fu">!!</span> diagonal
        divisorA      <span class="fu">=</span> fromMaybe defaultMatrixValue maybeDivisorA
        multiplierA   <span class="fu">=</span> <span class="fl">1.0</span> <span class="fu">/</span> divisorA
        multipliedA   <span class="fu">=</span> multiplyRow swappedA diagonal multiplierA
        multipliedB   <span class="fu">=</span> multiplyRow swappedB diagonal multiplierA
        cleared       <span class="fu">=</span> clearColumnExceptPivot (<span class="dt">Tuple</span> multipliedA multipliedB) (<span class="dt">Tuple</span> diagonal diagonal)
        clearedA      <span class="fu">=</span> fst cleared
        clearedB      <span class="fu">=</span> snd cleared</code></pre></div>
<p>The last major function is <code>invertMatrix</code>.</p>
<p>Let us go ahead and break it down.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">invertMatrix ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span></code></pre></div>
<p>You can see that it takes the input matrix and returns a tuple. The first tuple element is either a string or a matrix and the second element is a matrix.</p>
<p>Users of this function can test the first element of the returned tuple. If it is a string, there was an issue with trying to invert the matrix. However, if it is a matrix, then the inversion was possible and the first element will be the identity matrix and the second element will be the inverse of the input matrix.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">  <span class="fu">|</span> null matrix                 <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Empty matrix&quot;</span>)                (identityMatrix (length matrix))
  <span class="fu">|</span> not <span class="fu">$</span> isSquareMatrix matrix <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Not a square matrix&quot;</span>)         (identityMatrix (length matrix))
  <span class="fu">|</span> containsZeroRowOrCol matrix <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Contains zero row or column&quot;</span>) (identityMatrix (length matrix))
  <span class="fu">|</span> otherwise <span class="fu">=</span> result</code></pre></div>
<p>These are guard clauses that check if the input matrix satisfies our criteria. Notice that the first three guard clauses return a tuple containing the error message and the identity matrix. If the first three scenarios do not apply then we return the result.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    result ::</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
    result <span class="fu">=</span> foldl folder (<span class="dt">Tuple</span> (<span class="dt">Right</span> matrix) identity) (matrixToRange matrix)</code></pre></div>
<p>The <code>result</code> function reduces the input and identity matrix to either a string and identity matrix or the identity matrix and the matrix inverse.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    folder ::</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>

    folder t<span class="fu">@</span>(<span class="dt">Tuple</span> acc<span class="fu">@</span>(<span class="dt">Left</span>  _) _) _        <span class="fu">=</span> t

    folder t<span class="fu">@</span>(<span class="dt">Tuple</span> acc<span class="fu">@</span>(<span class="dt">Right</span> a) b) diagonal <span class="fu">=</span>
      <span class="kw">if</span> containsZeroRowOrCol a <span class="fu">||</span> null a <span class="fu">||</span> isNothing maybeDivisorA <span class="fu">||</span> divisorA <span class="fu">==</span> <span class="fl">0.0</span>
        <span class="kw">then</span> (<span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Cannot invert&quot;</span>) b)
        <span class="kw">else</span> (<span class="dt">Tuple</span> (<span class="dt">Right</span> clearedA) clearedB)</code></pre></div>
<p><code>folder</code> pattern matches twice. The first one matches if the first element of the input (the result of the last fold iteration) tuple is <code>Left</code> (which would be a string). In this scenario it just returns the tuple it was given. No need to keep trying as there must have been an error. The last one matches everything else but more specifically that the first element of the input tuple is <code>Right</code> (which would be a matrix). The last scenario checks four different cases before it proceeds.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">      <span class="kw">if</span> containsZeroRowOrCol a <span class="fu">||</span> null a <span class="fu">||</span> isNothing maybeDivisorA <span class="fu">||</span> divisorA <span class="fu">==</span> <span class="fl">0.0</span></code></pre></div>
<p>If any of these are true then it returns a tuple with an error string explaining that it could not invert the matrix and whatever was the second element of the input tuple. However, if they are all false, then it returns a tuple containing the updated matrices.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">        swapped       <span class="fu">=</span> swapWithValidRow (<span class="dt">Tuple</span> a b) diagonal
        swappedA      <span class="fu">=</span> fst swapped
        swappedB      <span class="fu">=</span> snd swapped
        divisorRowA   <span class="fu">=</span> fromMaybe [] (swappedA <span class="fu">!!</span> diagonal)
        maybeDivisorA <span class="fu">=</span> divisorRowA <span class="fu">!!</span> diagonal
        divisorA      <span class="fu">=</span> fromMaybe defaultMatrixValue maybeDivisorA
        multiplierA   <span class="fu">=</span> <span class="fl">1.0</span> <span class="fu">/</span> divisorA
        multipliedA   <span class="fu">=</span> multiplyRow swappedA diagonal multiplierA
        multipliedB   <span class="fu">=</span> multiplyRow swappedB diagonal multiplierA
        cleared       <span class="fu">=</span> clearColumnExceptPivot (<span class="dt">Tuple</span> multipliedA multipliedB) (<span class="dt">Tuple</span> diagonal diagonal)
        clearedA      <span class="fu">=</span> fst cleared
        clearedB      <span class="fu">=</span> snd cleared</code></pre></div>
<p>For each iteration of <code>foldl</code>, <code>folder</code> uses these functions.</p>
<p>You can see the progression from top to bottom.</p>
<ul>
<li>Swap current diagonal row with valid row</li>
<li>Get diagonal value of newly swapped row</li>
<li>Multiply the diagonal row by one over the diagonal
<ul>
<li>This turns the diagonal into a one or a pivot</li>
</ul></li>
<li>Zero out every value in the diagonal column except the pivot</li>
<li>Mirror all the operations in the second matrix</li>
</ul>
<p>Make sure to open up your favorite text editor and replace <code>src/MatrixInverse.purs</code> with the following code.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">{-</span>
<span class="co">  (C) 2017 David Lettier</span>
<span class="co">  lettier.com</span>
<span class="co">-}</span>

<span class="kw">module</span> <span class="dt">MatrixInverse</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Prelude</span>

<span class="kw">import </span><span class="dt">Data.Ord</span> (abs)
<span class="kw">import </span><span class="dt">Data.Foldable</span> (foldl)
<span class="kw">import </span><span class="dt">Data.Tuple</span> (<span class="dt">Tuple</span>(..), fst, snd)
<span class="kw">import </span><span class="dt">Data.Array</span> (head, length, null, range, slice, tail, updateAt, zip, (!!))
<span class="kw">import </span><span class="dt">Data.Either</span> (<span class="dt">Either</span>(..))
<span class="kw">import </span><span class="dt">Data.Maybe</span> (<span class="dt">Maybe</span>(<span class="dt">Just</span>, <span class="dt">Nothing</span>), fromMaybe, isNothing)

<span class="kw">type</span> <span class="dt">MatrixRow</span> <span class="fu">=</span> <span class="dt">Array</span> <span class="dt">Number</span>
<span class="kw">type</span> <span class="dt">Matrix</span> <span class="fu">=</span> <span class="dt">Array</span> <span class="dt">MatrixRow</span>

<span class="ot">invertMatrix ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
invertMatrix matrix
  <span class="fu">|</span> null matrix                 <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Empty matrix&quot;</span>)                (identityMatrix (length matrix))
  <span class="fu">|</span> not <span class="fu">$</span> isSquareMatrix matrix <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Not a square matrix&quot;</span>)         (identityMatrix (length matrix))
  <span class="fu">|</span> containsZeroRowOrCol matrix <span class="fu">=</span> <span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Contains zero row or column&quot;</span>) (identityMatrix (length matrix))
  <span class="fu">|</span> otherwise <span class="fu">=</span> result
  <span class="kw">where</span>
    matrixSize <span class="fu">=</span> length matrix
    identity   <span class="fu">=</span> identityMatrix matrixSize
<span class="ot">    result ::</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
    result <span class="fu">=</span> foldl folder (<span class="dt">Tuple</span> (<span class="dt">Right</span> matrix) identity) (matrixToRange matrix)
<span class="ot">    folder ::</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Matrix</span>) <span class="dt">Matrix</span>
    folder t<span class="fu">@</span>(<span class="dt">Tuple</span> acc<span class="fu">@</span>(<span class="dt">Left</span>  _) _) _        <span class="fu">=</span> t
    folder t<span class="fu">@</span>(<span class="dt">Tuple</span> acc<span class="fu">@</span>(<span class="dt">Right</span> a) b) diagonal <span class="fu">=</span>
      <span class="kw">if</span> containsZeroRowOrCol a <span class="fu">||</span> null a <span class="fu">||</span> isNothing maybeDivisorA <span class="fu">||</span> divisorA <span class="fu">==</span> <span class="fl">0.0</span>
        <span class="kw">then</span> (<span class="dt">Tuple</span> (<span class="dt">Left</span> <span class="st">&quot;Cannot invert&quot;</span>) b)
        <span class="kw">else</span> (<span class="dt">Tuple</span> (<span class="dt">Right</span> clearedA) clearedB)
      <span class="kw">where</span>
        swapped       <span class="fu">=</span> swapWithValidRow (<span class="dt">Tuple</span> a b) diagonal
        swappedA      <span class="fu">=</span> fst swapped
        swappedB      <span class="fu">=</span> snd swapped
        divisorRowA   <span class="fu">=</span> fromMaybe [] (swappedA <span class="fu">!!</span> diagonal)
        maybeDivisorA <span class="fu">=</span> divisorRowA <span class="fu">!!</span> diagonal
        divisorA      <span class="fu">=</span> fromMaybe defaultMatrixValue maybeDivisorA
        multiplierA   <span class="fu">=</span> <span class="fl">1.0</span> <span class="fu">/</span> divisorA
        multipliedA   <span class="fu">=</span> multiplyRow swappedA diagonal multiplierA
        multipliedB   <span class="fu">=</span> multiplyRow swappedB diagonal multiplierA
        cleared       <span class="fu">=</span> clearColumnExceptPivot (<span class="dt">Tuple</span> multipliedA multipliedB) (<span class="dt">Tuple</span> diagonal diagonal)
        clearedA      <span class="fu">=</span> fst cleared
        clearedB      <span class="fu">=</span> snd cleared

<span class="ot">defaultMatrix ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
defaultMatrix size <span class="fu">=</span> buildMatrix size value
  <span class="kw">where</span>
    value _ _ <span class="fu">=</span> defaultMatrixValue

<span class="ot">identityMatrix ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
identityMatrix size <span class="fu">=</span> buildMatrix size value
  <span class="kw">where</span>
    value row col <span class="fu">|</span> row <span class="fu">==</span> col <span class="fu">=</span> <span class="fl">1.0</span>
                  <span class="fu">|</span> otherwise  <span class="fu">=</span> <span class="fl">0.0</span>

<span class="ot">buildMatrix ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> (<span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span>) <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
buildMatrix <span class="dv">0</span>    _ <span class="fu">=</span> []
buildMatrix size f <span class="fu">=</span> map (\ row <span class="ot">-&gt;</span> map (\ col <span class="ot">-&gt;</span> f row col) matrixRange) matrixRange
  <span class="kw">where</span>
    matrixRange <span class="fu">=</span> range <span class="dv">0</span> (size <span class="fu">-</span> <span class="dv">1</span>)

<span class="ot">matrixSizeValid ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
matrixSizeValid size <span class="fu">=</span> size <span class="fu">&lt;=</span> maxMatrixSize <span class="fu">&amp;&amp;</span> size <span class="fu">&gt;=</span> minMatrixSize

<span class="ot">maybeMatrixValue ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Number</span>
maybeMatrixValue matrix row col <span class="fu">=</span> <span class="kw">case</span> matrix <span class="fu">!!</span> row <span class="kw">of</span>
                                    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span>
                                    <span class="dt">Just</span> x  <span class="ot">-&gt;</span> x <span class="fu">!!</span> col

<span class="ot">matrixRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">MatrixRow</span>
matrixRow matrix i <span class="fu">=</span> fromMaybe [] (matrix <span class="fu">!!</span> i)

<span class="ot">firstValidRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Int</span>
firstValidRow []     _            _     <span class="fu">=</span> <span class="dt">Nothing</span>
firstValidRow matrix atRowOrBelow inCol <span class="fu">=</span> (foldl folder { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span>} tuples)<span class="fu">.</span>index
  <span class="kw">where</span>
    matrixLength <span class="fu">=</span> length matrix
    lastRow <span class="fu">=</span> matrixLength <span class="fu">-</span> <span class="dv">1</span>
    rowRange <span class="fu">=</span> range atRowOrBelow lastRow
    column <span class="fu">=</span> slice atRowOrBelow matrixLength (matrixRow (transpose matrix) inCol)
    tuples <span class="fu">=</span> zip rowRange column
<span class="ot">    folder ::</span> {<span class="ot"> index ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>,<span class="ot"> value ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> } <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> {<span class="ot"> index ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>,<span class="ot"> value ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> }
    folder { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span>} (<span class="dt">Tuple</span> a b) <span class="fu">=</span> { index<span class="fu">:</span> (<span class="dt">Just</span> a), value<span class="fu">:</span> (<span class="dt">Just</span> b) }
    folder r<span class="fu">@</span>{ index<span class="fu">:</span> (<span class="dt">Just</span> x), value<span class="fu">:</span> (<span class="dt">Just</span> y)} (<span class="dt">Tuple</span> a b) <span class="fu">=</span>
      <span class="kw">if</span> abs y <span class="fu">==</span> <span class="fl">1.0</span>
        <span class="kw">then</span> r
        <span class="kw">else</span>
          <span class="kw">if</span> abs b <span class="fu">&gt;=</span> abs y <span class="fu">||</span> abs b <span class="fu">==</span> <span class="fl">1.0</span>
            <span class="kw">then</span> { index<span class="fu">:</span> (<span class="dt">Just</span> a), value<span class="fu">:</span> (<span class="dt">Just</span> b) }
            <span class="kw">else</span> r
    folder _ _ <span class="fu">=</span> { index<span class="fu">:</span> <span class="dt">Nothing</span>, value<span class="fu">:</span> <span class="dt">Nothing</span> }

<span class="ot">swapWithValidRow ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
swapWithValidRow t<span class="fu">@</span>(<span class="dt">Tuple</span> a b) diagonal <span class="fu">=</span> <span class="dt">Tuple</span> a' b'
  <span class="kw">where</span>
    row <span class="fu">=</span> firstValidRow a diagonal diagonal
    yesSwap <span class="fu">=</span> <span class="kw">case</span> row <span class="kw">of</span>
                <span class="dt">Nothing</span> <span class="ot">-&gt;</span> false
                <span class="dt">Just</span> r  <span class="ot">-&gt;</span> r <span class="fu">/=</span> diagonal
    swapIfYes m <span class="fu">=</span>
      <span class="kw">if</span> yesSwap
         <span class="kw">then</span> swapRows m diagonal (fromMaybe diagonal row)
         <span class="kw">else</span> m
    a' <span class="fu">=</span> swapIfYes a
    b' <span class="fu">=</span> swapIfYes b

<span class="ot">transpose ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
transpose []     <span class="fu">=</span> []
transpose matrix <span class="fu">=</span> transpose' matrix []
  <span class="kw">where</span>
<span class="ot">    transpose' ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
    transpose' old new <span class="fu">=</span> <span class="kw">if</span> arrayHasNothing maybeHeads <span class="kw">then</span> new <span class="kw">else</span> transpose' tails (new <span class="fu">&lt;&gt;</span> [heads])
      <span class="kw">where</span>
        maybeHeads <span class="fu">=</span> map head old
        maybeTails <span class="fu">=</span> map tail old
        heads <span class="fu">=</span> map (fromMaybe <span class="fl">0.0</span>) maybeHeads
        tails <span class="fu">=</span> map (fromMaybe []) maybeTails
<span class="ot">        arrayHasNothing ::</span> forall a<span class="fu">.</span> <span class="dt">Array</span> (<span class="dt">Maybe</span> a) <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
        arrayHasNothing array <span class="fu">=</span> <span class="kw">case</span> array <span class="fu">!!</span> <span class="dv">0</span> <span class="kw">of</span>
                                  <span class="dt">Nothing</span>  <span class="ot">-&gt;</span> true
                                  (<span class="dt">Just</span> x) <span class="ot">-&gt;</span> isNothing x

<span class="ot">swapRows ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
swapRows []     _ _ <span class="fu">=</span> []
swapRows matrix a b <span class="fu">=</span> fromMaybe [] (updateRow b rowA (updateRow a rowB (<span class="dt">Just</span> matrix)))
  <span class="kw">where</span>
<span class="ot">    rowA ::</span> <span class="dt">Maybe</span> <span class="dt">MatrixRow</span>
    rowA <span class="fu">=</span> matrix <span class="fu">!!</span> a
<span class="ot">    rowB ::</span> <span class="dt">Maybe</span> <span class="dt">MatrixRow</span>
    rowB <span class="fu">=</span> matrix <span class="fu">!!</span> b
<span class="ot">    updateRow ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">MatrixRow</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Matrix</span>
    updateRow i (<span class="dt">Just</span> row) (<span class="dt">Just</span> matrix') <span class="fu">=</span> updateAt i row matrix'
    updateRow _ _ _ <span class="fu">=</span> <span class="dt">Nothing</span>

<span class="ot">multiplyRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
multiplyRow []     _   _          <span class="fu">=</span> []
multiplyRow matrix row multiplier <span class="fu">=</span> map (\ row' <span class="ot">-&gt;</span>
    <span class="kw">if</span> row <span class="fu">==</span> row'
      <span class="kw">then</span> map (\ value <span class="ot">-&gt;</span> value <span class="fu">*</span> multiplier) (matrixRow matrix row')
      <span class="kw">else</span> matrixRow matrix row'
  ) (matrixToRange matrix)

<span class="ot">clearValue ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
clearValue (<span class="dt">Tuple</span> aMat bMat) pivot<span class="fu">@</span>(<span class="dt">Tuple</span> pRow pCol) target<span class="fu">@</span>(<span class="dt">Tuple</span> tRow tCol) <span class="fu">=</span> <span class="dt">Tuple</span> aMat' bMat'
  <span class="kw">where</span>
<span class="ot">    pivotRowA ::</span> <span class="dt">MatrixRow</span>
    pivotRowA         <span class="fu">=</span> matrixRow aMat pRow
<span class="ot">    targetRowA ::</span> <span class="dt">MatrixRow</span>
    targetRowA        <span class="fu">=</span> matrixRow aMat tRow
<span class="ot">    pivotValueA ::</span> <span class="dt">Number</span>
    pivotValueA       <span class="fu">=</span> rowValue pivotRowA pCol
<span class="ot">    targetValueA ::</span> <span class="dt">Number</span>
    targetValueA      <span class="fu">=</span> rowValue targetRowA tCol
<span class="ot">    aMat' ::</span> <span class="dt">Matrix</span>
    aMat'             <span class="fu">=</span> multiplyAndSubtractRows aMat tRow pRow pivotValueA targetValueA
<span class="ot">    bMat' ::</span> <span class="dt">Matrix</span>
    bMat'             <span class="fu">=</span> multiplyAndSubtractRows bMat tRow pRow pivotValueA targetValueA
<span class="ot">    rowValue ::</span> <span class="dt">MatrixRow</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span>
    rowValue row col  <span class="fu">=</span> fromMaybe defaultMatrixValue (row  <span class="fu">!!</span> col)
<span class="ot">    multiplyAndSubtractRows ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Matrix</span>
    multiplyAndSubtractRows
      matrix
      leftSideRow
      rightSideRow
      leftMultiplier
      rightMultiplier
      <span class="fu">=</span> map (\ row <span class="ot">-&gt;</span> <span class="kw">if</span> row <span class="fu">==</span> leftSideRow
                        <span class="kw">then</span> leftRowValues'
                        <span class="kw">else</span> matrixRow matrix row
        ) (matrixToRange matrix)
      <span class="kw">where</span>
        leftRowValues  <span class="fu">=</span> matrixRow matrix leftSideRow
        rightRowValues <span class="fu">=</span> matrixRow matrix rightSideRow
        leftRowValues' <span class="fu">=</span> map (\ (<span class="dt">Tuple</span> l r) <span class="ot">-&gt;</span>
            leftMultiplier <span class="fu">*</span> l <span class="fu">-</span> rightMultiplier <span class="fu">*</span> r
          ) (zip leftRowValues rightRowValues)

<span class="ot">clearColumnExceptPivot ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
clearColumnExceptPivot t<span class="fu">@</span>(<span class="dt">Tuple</span> aMat bMat) pivot<span class="fu">@</span>(<span class="dt">Tuple</span> pRow pCol) <span class="fu">=</span> t'
  <span class="kw">where</span>
<span class="ot">    t' ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
    t' <span class="fu">=</span> foldl folder t (matrixToRange aMat)
<span class="ot">    folder ::</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Tuple</span> <span class="dt">Matrix</span> <span class="dt">Matrix</span>
    folder acc<span class="fu">@</span>(<span class="dt">Tuple</span> aMat' bMat') row <span class="fu">=</span>
      <span class="kw">if</span> row <span class="fu">==</span> pRow
        <span class="kw">then</span> acc
        <span class="kw">else</span> clearValue acc pivot (<span class="dt">Tuple</span> row pCol)

<span class="ot">containsZeroRowOrCol ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
containsZeroRowOrCol matrix <span class="fu">=</span> containsZeroRow matrix <span class="fu">||</span> containsZeroCol matrix

<span class="ot">containsZeroCol ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
containsZeroCol <span class="fu">=</span> containsZeroRow <span class="fu">&lt;&lt;&lt;</span> transpose

<span class="ot">containsZeroRow ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
containsZeroRow <span class="fu">=</span> foldl (\ acc row <span class="ot">-&gt;</span> acc <span class="fu">||</span> foldl (\ acc' value <span class="ot">-&gt;</span> acc' <span class="fu">&amp;&amp;</span> value <span class="fu">==</span> <span class="fl">0.0</span>) true row) false

<span class="ot">isSquareMatrix ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
isSquareMatrix matrix <span class="fu">=</span> foldl (\ acc row <span class="ot">-&gt;</span> acc <span class="fu">&amp;&amp;</span> length row <span class="fu">==</span> matrixLength) true matrix
  <span class="kw">where</span>
    matrixLength <span class="fu">=</span> length matrix

<span class="ot">matrixToRange ::</span> <span class="dt">Matrix</span> <span class="ot">-&gt;</span> <span class="dt">Array</span> <span class="dt">Int</span>
matrixToRange []     <span class="fu">=</span> []
matrixToRange matrix <span class="fu">=</span> (range <span class="dv">0</span> (length matrix <span class="fu">-</span> <span class="dv">1</span>))

<span class="ot">maxMatrixSize ::</span> <span class="dt">Int</span>
maxMatrixSize <span class="fu">=</span> <span class="dv">10</span>

<span class="ot">minMatrixSize ::</span> <span class="dt">Int</span>
minMatrixSize <span class="fu">=</span> <span class="dv">2</span>

<span class="ot">defaultMatrixValue ::</span> <span class="dt">Number</span>
defaultMatrixValue <span class="fu">=</span> <span class="fl">0.0</span></code></pre></div>
<h4 id="ui.purs">UI.purs</h4>
<p>Now that we have our matrix inverse library done, we can work on the user interface that will allow us to input and interact with our matrix inverse calculator.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">UI</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Prelude</span>

<span class="kw">import </span><span class="dt">Data.Generic</span> (gShow)
<span class="kw">import </span><span class="dt">Data.Int</span> (fromString)
<span class="kw">import </span><span class="dt">Data.Tuple</span> (fst, snd)
<span class="kw">import </span><span class="dt">Data.Array</span> (null, range, updateAt, (!!))
<span class="kw">import </span><span class="dt">Data.Either</span> (<span class="dt">Either</span>(..))
<span class="kw">import </span><span class="dt">Data.Maybe</span> (fromMaybe, isJust)

<span class="kw">import </span><span class="dt">Control.Monad.Aff</span> (<span class="dt">Aff</span>)
<span class="kw">import </span><span class="dt">Control.Monad.Aff.Free</span> (class <span class="dt">Affable</span>)
<span class="kw">import </span><span class="dt">Control.Monad.Aff.Console</span> (<span class="dt">CONSOLE</span>, log)
<span class="kw">import </span><span class="dt">Control.Monad.Eff</span> (<span class="dt">Eff</span>)

<span class="kw">import </span><span class="dt">Halogen</span> <span class="kw">as</span> <span class="dt">H</span>
<span class="kw">import </span><span class="dt">Halogen.HTML.Core</span> (className)
<span class="kw">import </span><span class="dt">Halogen.HTML.Events.Indexed</span> <span class="kw">as</span> <span class="dt">HE</span>
<span class="kw">import </span><span class="dt">Halogen.HTML.Properties.Indexed</span> <span class="kw">as</span> <span class="dt">HP</span>
<span class="kw">import </span><span class="dt">Halogen.HTML.Indexed</span> <span class="kw">as</span> <span class="dt">HH</span>
<span class="kw">import </span><span class="dt">Halogen.Util</span> (awaitBody, runHalogenAff, selectElement)

<span class="kw">import </span><span class="dt">Utils</span> (
      maybeToString
    , stringToMaybeNumber
  )

<span class="kw">import </span><span class="dt">MatrixInverse</span> (
      <span class="dt">Matrix</span>
    , invertMatrix
    , matrixSizeValid
    , maybeMatrixValue
    , defaultMatrix
    , identityMatrix
    , defaultMatrixValue
    , minMatrixSize
    , maxMatrixSize
  )</code></pre></div>
<p>Like before we define the <code>UI</code> module and we import our dependencies. Notice how we import our custom <code>MatrixInverse</code> library.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">State</span> <span class="fu">=</span> {
<span class="ot">      matrixSize ::</span> <span class="dt">Int</span>
    ,<span class="ot"> matrixA ::</span> <span class="dt">Matrix</span>
    ,<span class="ot"> matrixB ::</span> <span class="dt">Matrix</span>
    ,<span class="ot"> status ::</span> <span class="dt">String</span>
    ,<span class="ot"> running ::</span> <span class="dt">Boolean</span>
    ,<span class="ot"> finished ::</span> <span class="dt">Boolean</span>
  }

<span class="ot">initialState ::</span> <span class="dt">State</span>
initialState <span class="fu">=</span> { matrixSize<span class="fu">:</span> <span class="dv">0</span>, matrixA<span class="fu">:</span> [], matrixB<span class="fu">:</span> [], status<span class="fu">:</span> <span class="st">&quot;&quot;</span>, running<span class="fu">:</span> false, finished<span class="fu">:</span> false }</code></pre></div>
<p>Our UI state consists of the size of the matrix, two matrices, a status message, and two Booleans indicating if the calculator is running and if it finished the calculation after having run.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Query</span> a <span class="fu">=</span> <span class="dt">UpdateMatrixSize</span> <span class="dt">String</span> a <span class="fu">|</span> <span class="dt">UpdateMatrixValue</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="dt">String</span> a <span class="fu">|</span> <span class="dt">Run</span> a</code></pre></div>
<p>Our UI is setup to handle three messages or <em>queries</em>. The first updates the size of the input matrix. The second updates the input matrix with a new value at the specified row and column. The third fires off the inversion attempt then updates the UI component’s state once the calculator comes back with a result.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">      HH.div_
        [
            HH.div_ [
                  HH.div [
                        HP.class_ (className <span class="st">&quot;status&quot;</span>)
                    ] [
                        HH.b_ [ HH.text <span class="st">&quot;Status: &quot;</span> ]
                      , HH.text state<span class="fu">.</span>status
                    ]
                , HH.input [
                        HP.value <span class="st">&quot;&quot;</span>
                      , HP.placeholder <span class="st">&quot;Input Matrix Size and Press Enter&quot;</span>
                      , HE.onValueChange (HE.input <span class="dt">UpdateMatrixSize</span>)
                      , HP.class_ (className <span class="st">&quot;matrixSizeInput&quot;</span>)
                    ]
                , HH.button [
                        HE.onClick (HE.input_ <span class="dt">Run</span>)
                      , HP.class_ (className <span class="st">&quot;runButton&quot;</span>)
                      , HP.title <span class="st">&quot;RUN&quot;</span>
                    ] [
                        HH.text <span class="st">&quot;RUN&quot;</span>
                    ]
              ]</code></pre></div>
<p>Directly in the code we define the HTML. This part contains the status message, matrix size input box, and the run button.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">            <span class="kw">if</span> matrixSizeValid state<span class="fu">.</span>matrixSize
              <span class="kw">then</span> [
                    HH.div [
                          HP.class_ (className <span class="st">&quot;matrixAContainer&quot;</span>)
                      ] (
                        map (\ row <span class="ot">-&gt;</span>
                              HH.div [
                                    HP.class_ (className <span class="st">&quot;matrixRow&quot;</span>)
                                ] (
                                  map (\ col <span class="ot">-&gt;</span>
                                      HH.div [
                                            HP.classes <span class="fu">$</span> map className [<span class="st">&quot;matrixValue&quot;</span>]
                                        ] [
                                            HH.input [
                                                  HP.value <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixA row col
                                                , HP.placeholder (gShow defaultMatrixValue)
                                                , HE.onValueChange (HE.input (<span class="dt">UpdateMatrixValue</span> row col))
                                                , HP.classes <span class="fu">$</span> map className [
                                                      <span class="st">&quot;matrixValueInput&quot;</span>
                                                    , <span class="kw">if</span> row <span class="fu">==</span> col
                                                        <span class="kw">then</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;lightRed&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;lightBlue&quot;</span>
                                                        <span class="kw">else</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;red&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;blue&quot;</span>
                                                  ]
                                                , HP.disabled state<span class="fu">.</span>running
                                                , HP.title <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixA row col
                                              ]
                                        ]
                                    ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span><span class="dv">1</span>))
                                )
                          ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span> <span class="dv">1</span>))
                      )</code></pre></div>
<p>If the matrix size is valid, we display all of the input boxes that make up the input matrix. Using CSS, we color the diagonal input boxes slightly different. Once a run finishes, we swap the colors of the left and right matrix.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">                  , HH.div [
                          HP.class_ (className <span class="st">&quot;matrixBContainer&quot;</span>)
                      ] (
                        map (\ row <span class="ot">-&gt;</span>
                              HH.div [
                                    HP.class_ (className <span class="st">&quot;matrixRow&quot;</span>)
                                ] (
                                  map (\ col <span class="ot">-&gt;</span>
                                      HH.div [
                                            HP.classes <span class="fu">$</span> map className [<span class="st">&quot;matrixValue&quot;</span>]
                                        ] [
                                            HH.input [
                                                  HP.value <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixB row col
                                                , HP.placeholder (gShow defaultMatrixValue)
                                                , HP.classes <span class="fu">$</span> map className [
                                                      <span class="st">&quot;matrixValueInput&quot;</span>
                                                    , <span class="kw">if</span> row <span class="fu">==</span> col
                                                        <span class="kw">then</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;lightBlue&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;lightRed&quot;</span>
                                                        <span class="kw">else</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;blue&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;red&quot;</span>
                                                  ]
                                                , HP.disabled true
                                                , HP.title <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixB row col
                                              ]
                                        ]
                                    ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span><span class="dv">1</span>))
                                )
                          ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span> <span class="dv">1</span>))
                      )
                ]</code></pre></div>
<p>Here we update the DOM with what is initially the identity matrix. After a successful run, it will be the matrix inverse. Since this is not the input matrix, we disable all of the input fields.</p>
<p>With the dynamic HTML in place, we can create the functions that will handle our three query messages.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">    eval ::</span> <span class="dt">Query</span> <span class="fu">~&gt;</span> <span class="dt">H.ComponentDSL</span> <span class="dt">State</span> <span class="dt">Query</span> (<span class="dt">Aff</span> (<span class="dt">Effects</span> eff))
    eval (<span class="dt">UpdateMatrixSize</span> value next) <span class="fu">=</span> <span class="kw">do</span>
      <span class="kw">let</span> matrixSize <span class="fu">=</span> fromMaybe <span class="dv">0</span> (fromString value)
      <span class="kw">if</span> not <span class="fu">$</span> matrixSizeValid matrixSize
        <span class="kw">then</span> H.modify (\ state <span class="ot">-&gt;</span>
            state {
                  matrixSize <span class="fu">=</span> <span class="dv">0</span>
                , matrixA    <span class="fu">=</span> []
                , matrixB    <span class="fu">=</span> []
                , status     <span class="fu">=</span> <span class="st">&quot;Enter a number between &quot;</span> <span class="fu">&lt;&gt;</span> (gShow minMatrixSize) <span class="fu">&lt;&gt;</span> <span class="st">&quot; and &quot;</span> <span class="fu">&lt;&gt;</span> (gShow maxMatrixSize)
                , running    <span class="fu">=</span> false
                , finished   <span class="fu">=</span> false
              }
          )
        <span class="kw">else</span> <span class="kw">do</span>
          H.modify (\ state <span class="ot">-&gt;</span>
              state {
                    matrixSize <span class="fu">=</span> matrixSize
                  , matrixA    <span class="fu">=</span> defaultMatrix matrixSize
                  , matrixB    <span class="fu">=</span> identityMatrix matrixSize
                  , status     <span class="fu">=</span> <span class="st">&quot;&quot;</span>
                  , running    <span class="fu">=</span> false
                  , finished   <span class="fu">=</span> false
                }
            )
      pure next</code></pre></div>
<p>After the user attempts to update the matrix size, we check to see if the value is valid. If valid, we go ahead and create a default and identity matrix. If invalid, we update the status message and clear out both of the state’s matrices.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    eval (<span class="dt">UpdateMatrixValue</span> row col value next) <span class="fu">=</span> <span class="kw">do</span>
      log' value
      currentState <span class="ot">&lt;-</span> H.get
      <span class="kw">let</span> maybeNumber <span class="fu">=</span> stringToMaybeNumber value
      <span class="kw">let</span> matrixRow <span class="fu">=</span> fromMaybe [] (currentState<span class="fu">.</span>matrixA <span class="fu">!!</span> row)
      <span class="kw">let</span> number <span class="fu">=</span> fromMaybe defaultMatrixValue maybeNumber
      when (not <span class="fu">$</span> null matrixRow) <span class="kw">do</span>
        <span class="kw">let</span> maybeUpdatedRow <span class="fu">=</span> updateAt col number matrixRow
        when (isJust maybeUpdatedRow) <span class="kw">do</span>
          <span class="kw">let</span> updatedRow <span class="fu">=</span> fromMaybe [] maybeUpdatedRow
          <span class="kw">let</span> maybeUpdatedMatrix <span class="fu">=</span> updateAt row updatedRow currentState<span class="fu">.</span>matrixA
          when (isJust maybeUpdatedMatrix) <span class="kw">do</span>
            H.modify (\ state <span class="ot">-&gt;</span>
                state {
                      matrixA  <span class="fu">=</span> (fromMaybe [] maybeUpdatedMatrix)
                    , running  <span class="fu">=</span> false
                    , finished <span class="fu">=</span> false
                  }
              )
      pure next</code></pre></div>
<p>When the user inputs a matrix value, we perform error checking and if valid, we update the state’s <code>matrixA</code> with the new value at the specified row and column number.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    eval (<span class="dt">Run</span> next) <span class="fu">=</span> <span class="kw">do</span>
      H.modify (\ state <span class="ot">-&gt;</span> state { status <span class="fu">=</span> <span class="st">&quot;Running&quot;</span>, running <span class="fu">=</span> true })
      currentState <span class="ot">&lt;-</span> H.get
      <span class="kw">let</span> matrix <span class="fu">=</span> currentState<span class="fu">.</span>matrixA
      log' (gShow matrix)
      <span class="kw">let</span> result <span class="fu">=</span> invertMatrix matrix
      <span class="kw">let</span> fstResult <span class="fu">=</span> fst result
      <span class="kw">let</span> sndResult <span class="fu">=</span> snd result
      <span class="kw">case</span> fstResult <span class="kw">of</span>
        <span class="dt">Left</span> s <span class="ot">-&gt;</span>
          H.modify (\ state <span class="ot">-&gt;</span>
              state {
                    status  <span class="fu">=</span> s
                  , running <span class="fu">=</span> false
                  , finished <span class="fu">=</span> false
                }
            )
        <span class="dt">Right</span> m <span class="ot">-&gt;</span> <span class="kw">do</span>
          log' (gShow m)
          log' (gShow sndResult)
          H.modify (\ state <span class="ot">-&gt;</span>
              state {
                    status   <span class="fu">=</span> <span class="st">&quot;Finished&quot;</span>
                  , matrixA  <span class="fu">=</span> m
                  , matrixB  <span class="fu">=</span> sndResult
                  , running  <span class="fu">=</span> false
                  , finished <span class="fu">=</span> true
                }
            )
      pure next</code></pre></div>
<p>After clicking the run button, we set the state’s <code>status</code> and <code>running</code> attribute. Next we get the current input matrix and attempt to invert it. If there was an error, we update the <code>status</code>. Otherwise we set <code>matrixA</code> to the identity matrix and set <code>matrixB</code> to the inverse of the input matrix (as returned by <code>invertMatrix</code>).</p>
<p>Make sure to open up your favorite text editor and replace <code>src/UI.purs</code> with the following code.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">{-</span>
<span class="co">  (C) 2017 David Lettier</span>
<span class="co">  lettier.com</span>
<span class="co">-}</span>

<span class="kw">module</span> <span class="dt">UI</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Prelude</span>

<span class="kw">import </span><span class="dt">Data.Generic</span> (gShow)
<span class="kw">import </span><span class="dt">Data.Int</span> (fromString)
<span class="kw">import </span><span class="dt">Data.Tuple</span> (fst, snd)
<span class="kw">import </span><span class="dt">Data.Array</span> (null, range, updateAt, (!!))
<span class="kw">import </span><span class="dt">Data.Either</span> (<span class="dt">Either</span>(..))
<span class="kw">import </span><span class="dt">Data.Maybe</span> (fromMaybe, isJust)

<span class="kw">import </span><span class="dt">Control.Monad.Aff</span> (<span class="dt">Aff</span>)
<span class="kw">import </span><span class="dt">Control.Monad.Aff.Free</span> (class <span class="dt">Affable</span>)
<span class="kw">import </span><span class="dt">Control.Monad.Aff.Console</span> (<span class="dt">CONSOLE</span>, log)
<span class="kw">import </span><span class="dt">Control.Monad.Eff</span> (<span class="dt">Eff</span>)

<span class="kw">import </span><span class="dt">Halogen</span> <span class="kw">as</span> <span class="dt">H</span>
<span class="kw">import </span><span class="dt">Halogen.HTML.Core</span> (className)
<span class="kw">import </span><span class="dt">Halogen.HTML.Events.Indexed</span> <span class="kw">as</span> <span class="dt">HE</span>
<span class="kw">import </span><span class="dt">Halogen.HTML.Properties.Indexed</span> <span class="kw">as</span> <span class="dt">HP</span>
<span class="kw">import </span><span class="dt">Halogen.HTML.Indexed</span> <span class="kw">as</span> <span class="dt">HH</span>
<span class="kw">import </span><span class="dt">Halogen.Util</span> (awaitBody, runHalogenAff, selectElement)

<span class="kw">import </span><span class="dt">Utils</span> (
      maybeToString
    , stringToMaybeNumber
  )

<span class="kw">import </span><span class="dt">MatrixInverse</span> (
      <span class="dt">Matrix</span>
    , invertMatrix
    , matrixSizeValid
    , maybeMatrixValue
    , defaultMatrix
    , identityMatrix
    , defaultMatrixValue
    , minMatrixSize
    , maxMatrixSize
  )

<span class="kw">type</span> <span class="dt">Effects</span> eff <span class="fu">=</span> <span class="dt">H.HalogenEffects</span> (<span class="ot">console ::</span> <span class="dt">CONSOLE</span> <span class="fu">|</span> eff)

<span class="kw">data</span> <span class="dt">Query</span> a <span class="fu">=</span> <span class="dt">UpdateMatrixSize</span> <span class="dt">String</span> a <span class="fu">|</span> <span class="dt">UpdateMatrixValue</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="dt">String</span> a <span class="fu">|</span> <span class="dt">Run</span> a

<span class="kw">type</span> <span class="dt">State</span> <span class="fu">=</span> {
<span class="ot">      matrixSize ::</span> <span class="dt">Int</span>
    ,<span class="ot"> matrixA ::</span> <span class="dt">Matrix</span>
    ,<span class="ot"> matrixB ::</span> <span class="dt">Matrix</span>
    ,<span class="ot"> status ::</span> <span class="dt">String</span>
    ,<span class="ot"> running ::</span> <span class="dt">Boolean</span>
    ,<span class="ot"> finished ::</span> <span class="dt">Boolean</span>
  }

<span class="ot">initialState ::</span> <span class="dt">State</span>
initialState <span class="fu">=</span> { matrixSize<span class="fu">:</span> <span class="dv">0</span>, matrixA<span class="fu">:</span> [], matrixB<span class="fu">:</span> [], status<span class="fu">:</span> <span class="st">&quot;&quot;</span>, running<span class="fu">:</span> false, finished<span class="fu">:</span> false }

<span class="ot">runApp ::</span> <span class="dt">Eff</span> (<span class="dt">Effects</span> ()) <span class="dt">Unit</span>
runApp <span class="fu">=</span> runHalogenAff <span class="kw">do</span>
  body <span class="ot">&lt;-</span> awaitBody
  uiContainer <span class="ot">&lt;-</span> selectElement <span class="st">&quot;#uiContainer&quot;</span>
  H.runUI matrixUIComponent initialState (fromMaybe body uiContainer)

<span class="ot">matrixUIComponent ::</span> forall eff<span class="fu">.</span> <span class="dt">H.Component</span> <span class="dt">State</span> <span class="dt">Query</span> (<span class="dt">Aff</span> (<span class="dt">Effects</span> eff))
matrixUIComponent <span class="fu">=</span> H.component { render, eval }
  <span class="kw">where</span>
<span class="ot">    render ::</span> <span class="dt">State</span> <span class="ot">-&gt;</span> <span class="dt">H.ComponentHTML</span> <span class="dt">Query</span>
    render state <span class="fu">=</span>
      HH.div_
        [
            HH.div_ [
                  HH.div [
                        HP.class_ (className <span class="st">&quot;status&quot;</span>)
                    ] [
                        HH.b_ [ HH.text <span class="st">&quot;Status: &quot;</span> ]
                      , HH.text state<span class="fu">.</span>status
                    ]
                , HH.input [
                        HP.value <span class="st">&quot;&quot;</span>
                      , HP.placeholder <span class="st">&quot;Input Matrix Size and Press Enter&quot;</span>
                      , HE.onValueChange (HE.input <span class="dt">UpdateMatrixSize</span>)
                      , HP.class_ (className <span class="st">&quot;matrixSizeInput&quot;</span>)
                    ]
                , HH.button [
                        HE.onClick (HE.input_ <span class="dt">Run</span>)
                      , HP.class_ (className <span class="st">&quot;runButton&quot;</span>)
                      , HP.title <span class="st">&quot;RUN&quot;</span>
                    ] [
                        HH.text <span class="st">&quot;RUN&quot;</span>
                    ]
              ]
          , HH.div [
              HP.class_ (className <span class="st">&quot;matricesContainer&quot;</span>)
            ]
            <span class="kw">if</span> matrixSizeValid state<span class="fu">.</span>matrixSize
              <span class="kw">then</span> [
                    HH.div [
                          HP.class_ (className <span class="st">&quot;matrixAContainer&quot;</span>)
                      ] (
                        map (\ row <span class="ot">-&gt;</span>
                              HH.div [
                                    HP.class_ (className <span class="st">&quot;matrixRow&quot;</span>)
                                ] (
                                  map (\ col <span class="ot">-&gt;</span>
                                      HH.div [
                                            HP.classes <span class="fu">$</span> map className [<span class="st">&quot;matrixValue&quot;</span>]
                                        ] [
                                            HH.input [
                                                  HP.value <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixA row col
                                                , HP.placeholder (gShow defaultMatrixValue)
                                                , HE.onValueChange (HE.input (<span class="dt">UpdateMatrixValue</span> row col))
                                                , HP.classes <span class="fu">$</span> map className [
                                                      <span class="st">&quot;matrixValueInput&quot;</span>
                                                    , <span class="kw">if</span> row <span class="fu">==</span> col
                                                        <span class="kw">then</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;lightRed&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;lightBlue&quot;</span>
                                                        <span class="kw">else</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;red&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;blue&quot;</span>
                                                  ]
                                                , HP.disabled state<span class="fu">.</span>running
                                                , HP.title <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixA row col
                                              ]
                                        ]
                                    ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span><span class="dv">1</span>))
                                )
                          ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span> <span class="dv">1</span>))
                      )
                  , HH.div [
                          HP.class_ (className <span class="st">&quot;matrixBContainer&quot;</span>)
                      ] (
                        map (\ row <span class="ot">-&gt;</span>
                              HH.div [
                                    HP.class_ (className <span class="st">&quot;matrixRow&quot;</span>)
                                ] (
                                  map (\ col <span class="ot">-&gt;</span>
                                      HH.div [
                                            HP.classes <span class="fu">$</span> map className [<span class="st">&quot;matrixValue&quot;</span>]
                                        ] [
                                            HH.input [
                                                  HP.value <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixB row col
                                                , HP.placeholder (gShow defaultMatrixValue)
                                                , HP.classes <span class="fu">$</span> map className [
                                                      <span class="st">&quot;matrixValueInput&quot;</span>
                                                    , <span class="kw">if</span> row <span class="fu">==</span> col
                                                        <span class="kw">then</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;lightBlue&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;lightRed&quot;</span>
                                                        <span class="kw">else</span>
                                                          <span class="kw">if</span> state<span class="fu">.</span>finished
                                                            <span class="kw">then</span> <span class="st">&quot;blue&quot;</span>
                                                            <span class="kw">else</span> <span class="st">&quot;red&quot;</span>
                                                  ]
                                                , HP.disabled true
                                                , HP.title <span class="fu">$</span> maybeToString <span class="fu">$</span> maybeMatrixValue state<span class="fu">.</span>matrixB row col
                                              ]
                                        ]
                                    ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span><span class="dv">1</span>))
                                )
                          ) (range <span class="dv">0</span> (state<span class="fu">.</span>matrixSize <span class="fu">-</span> <span class="dv">1</span>))
                      )
                ]
              <span class="kw">else</span> []
        ]
<span class="ot">    eval ::</span> <span class="dt">Query</span> <span class="fu">~&gt;</span> <span class="dt">H.ComponentDSL</span> <span class="dt">State</span> <span class="dt">Query</span> (<span class="dt">Aff</span> (<span class="dt">Effects</span> eff))
    eval (<span class="dt">UpdateMatrixSize</span> value next) <span class="fu">=</span> <span class="kw">do</span>
      <span class="kw">let</span> matrixSize <span class="fu">=</span> fromMaybe <span class="dv">0</span> (fromString value)
      <span class="kw">if</span> not <span class="fu">$</span> matrixSizeValid matrixSize
        <span class="kw">then</span> H.modify (\ state <span class="ot">-&gt;</span>
            state {
                  matrixSize <span class="fu">=</span> <span class="dv">0</span>
                , matrixA    <span class="fu">=</span> []
                , matrixB    <span class="fu">=</span> []
                , status     <span class="fu">=</span> <span class="st">&quot;Enter a number between &quot;</span> <span class="fu">&lt;&gt;</span> (gShow minMatrixSize) <span class="fu">&lt;&gt;</span> <span class="st">&quot; and &quot;</span> <span class="fu">&lt;&gt;</span> (gShow maxMatrixSize)
                , running    <span class="fu">=</span> false
                , finished   <span class="fu">=</span> false
              }
          )
        <span class="kw">else</span> <span class="kw">do</span>
          H.modify (\ state <span class="ot">-&gt;</span>
              state {
                    matrixSize <span class="fu">=</span> matrixSize
                  , matrixA    <span class="fu">=</span> defaultMatrix matrixSize
                  , matrixB    <span class="fu">=</span> identityMatrix matrixSize
                  , status     <span class="fu">=</span> <span class="st">&quot;&quot;</span>
                  , running    <span class="fu">=</span> false
                  , finished   <span class="fu">=</span> false
                }
            )
      pure next
    eval (<span class="dt">UpdateMatrixValue</span> row col value next) <span class="fu">=</span> <span class="kw">do</span>
      log' value
      currentState <span class="ot">&lt;-</span> H.get
      <span class="kw">let</span> maybeNumber <span class="fu">=</span> stringToMaybeNumber value
      <span class="kw">let</span> matrixRow <span class="fu">=</span> fromMaybe [] (currentState<span class="fu">.</span>matrixA <span class="fu">!!</span> row)
      <span class="kw">let</span> number <span class="fu">=</span> fromMaybe defaultMatrixValue maybeNumber
      when (not <span class="fu">$</span> null matrixRow) <span class="kw">do</span>
        <span class="kw">let</span> maybeUpdatedRow <span class="fu">=</span> updateAt col number matrixRow
        when (isJust maybeUpdatedRow) <span class="kw">do</span>
          <span class="kw">let</span> updatedRow <span class="fu">=</span> fromMaybe [] maybeUpdatedRow
          <span class="kw">let</span> maybeUpdatedMatrix <span class="fu">=</span> updateAt row updatedRow currentState<span class="fu">.</span>matrixA
          when (isJust maybeUpdatedMatrix) <span class="kw">do</span>
            H.modify (\ state <span class="ot">-&gt;</span>
                state {
                      matrixA  <span class="fu">=</span> (fromMaybe [] maybeUpdatedMatrix)
                    , running  <span class="fu">=</span> false
                    , finished <span class="fu">=</span> false
                  }
              )
      pure next
    eval (<span class="dt">Run</span> next) <span class="fu">=</span> <span class="kw">do</span>
      H.modify (\ state <span class="ot">-&gt;</span> state { status <span class="fu">=</span> <span class="st">&quot;Running&quot;</span>, running <span class="fu">=</span> true })
      currentState <span class="ot">&lt;-</span> H.get
      <span class="kw">let</span> matrix <span class="fu">=</span> currentState<span class="fu">.</span>matrixA
      log' (gShow matrix)
      <span class="kw">let</span> result <span class="fu">=</span> invertMatrix matrix
      <span class="kw">let</span> fstResult <span class="fu">=</span> fst result
      <span class="kw">let</span> sndResult <span class="fu">=</span> snd result
      <span class="kw">case</span> fstResult <span class="kw">of</span>
        <span class="dt">Left</span> s <span class="ot">-&gt;</span>
          H.modify (\ state <span class="ot">-&gt;</span>
              state {
                    status  <span class="fu">=</span> s
                  , running <span class="fu">=</span> false
                  , finished <span class="fu">=</span> false
                }
            )
        <span class="dt">Right</span> m <span class="ot">-&gt;</span> <span class="kw">do</span>
          log' (gShow m)
          log' (gShow sndResult)
          H.modify (\ state <span class="ot">-&gt;</span>
              state {
                    status   <span class="fu">=</span> <span class="st">&quot;Finished&quot;</span>
                  , matrixA  <span class="fu">=</span> m
                  , matrixB  <span class="fu">=</span> sndResult
                  , running  <span class="fu">=</span> false
                  , finished <span class="fu">=</span> true
                }
            )
      pure next

<span class="ot">log' ::</span> forall a b<span class="fu">.</span> <span class="dt">Affable</span> (<span class="ot">console ::</span> <span class="dt">CONSOLE</span> <span class="fu">|</span> b) a <span class="ot">=&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> a <span class="dt">Unit</span>
log' string <span class="fu">=</span> H.fromAff <span class="fu">$</span> when debug <span class="fu">$</span> log string

<span class="ot">debug ::</span> <span class="dt">Boolean</span>
debug <span class="fu">=</span> true</code></pre></div>
<h4 id="utils.purs">Utils.purs</h4>
<p>The utility module contains various functions that ease development.</p>
<p>Make sure to open up your favorite text editor and replace <code>src/Utils.purs</code> with the following code.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">{-</span>
<span class="co">  (C) 2017 David Lettier</span>
<span class="co">  lettier.com</span>
<span class="co">-}</span>

<span class="kw">module</span> <span class="dt">Utils</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Prelude</span>

<span class="kw">import </span><span class="dt">Global</span> (readFloat, isNaN, isFinite)

<span class="kw">import </span><span class="dt">Data.Generic</span> (class <span class="dt">Generic</span>, gShow)
<span class="kw">import </span><span class="dt">Data.Array</span> (length, head)
<span class="kw">import </span><span class="dt">Data.Maybe</span> (<span class="dt">Maybe</span>(..), fromMaybe)
<span class="kw">import </span><span class="dt">Data.Foldable</span> (foldl)
<span class="kw">import </span><span class="dt">Data.Int</span> (toNumber)

<span class="ot">firstOrSecondValues ::</span> (<span class="dt">Array</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Number</span>) <span class="ot">-&gt;</span> <span class="dt">Array</span> (<span class="dt">Array</span> <span class="dt">Number</span>) <span class="ot">-&gt;</span> <span class="dt">Array</span> <span class="dt">Number</span>
firstOrSecondValues f [] <span class="fu">=</span> []
firstOrSecondValues f es <span class="fu">=</span> foldl innerFold [] (map f es)
  <span class="kw">where</span>
    innerFold acc (<span class="dt">Just</span> e) <span class="fu">=</span> acc <span class="fu">&lt;&gt;</span> [e]
    innerFold acc <span class="dt">Nothing</span>  <span class="fu">=</span> acc

<span class="ot">first ::</span> <span class="dt">Array</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Number</span>
first [x, y] <span class="fu">=</span> <span class="dt">Just</span> x
first _      <span class="fu">=</span> <span class="dt">Nothing</span>

<span class="ot">second ::</span> <span class="dt">Array</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Number</span>
second [x, y] <span class="fu">=</span> <span class="dt">Just</span> y
second _      <span class="fu">=</span> <span class="dt">Nothing</span>

<span class="ot">lengthNum ::</span> forall a<span class="fu">.</span> <span class="dt">Array</span> a <span class="ot">-&gt;</span> <span class="dt">Number</span>
lengthNum [] <span class="fu">=</span> <span class="fl">0.0</span>
lengthNum xs <span class="fu">=</span> (toNumber <span class="fu">&lt;&lt;&lt;</span> length) xs

<span class="ot">stringToMaybeNumber ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Number</span>
stringToMaybeNumber s <span class="fu">=</span> maybeNumber
  <span class="kw">where</span>
<span class="ot">    float ::</span> <span class="dt">Number</span>
    float <span class="fu">=</span> readFloat s
<span class="ot">    maybeNumber ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span>
    maybeNumber <span class="fu">=</span> <span class="kw">if</span> isNaN float <span class="kw">then</span> <span class="dt">Nothing</span> <span class="kw">else</span> <span class="dt">Just</span> float

<span class="ot">maybeNumberToString ::</span> <span class="dt">Maybe</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
maybeNumberToString <span class="dt">Nothing</span>  <span class="fu">=</span> <span class="st">&quot;&quot;</span>
maybeNumberToString (<span class="dt">Just</span> a) <span class="fu">=</span> gShow a

<span class="ot">isInfinity ::</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
isInfinity <span class="fu">=</span> not <span class="fu">&lt;&lt;&lt;</span> isFinite

<span class="ot">arrayMinOrMax ::</span> forall a<span class="fu">.</span> (<span class="dt">Ord</span> a) <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Array</span> a <span class="ot">-&gt;</span> a
arrayMinOrMax _ default []     <span class="fu">=</span> default
arrayMinOrMax f _       [h]    <span class="fu">=</span> h
arrayMinOrMax f default values <span class="fu">=</span> foldl (\ acc value <span class="ot">-&gt;</span> f acc value) (fromMaybe default (head values)) values

<span class="ot">numberInvalid ::</span> <span class="dt">Number</span> <span class="ot">-&gt;</span> <span class="dt">Boolean</span>
numberInvalid n <span class="fu">=</span> isNaN n <span class="fu">||</span> isInfinity n

<span class="ot">maybeToString ::</span> forall a<span class="fu">.</span> <span class="dt">Generic</span> a <span class="ot">=&gt;</span> <span class="dt">Maybe</span> a <span class="ot">-&gt;</span> <span class="dt">String</span>
maybeToString maybe <span class="fu">=</span> <span class="kw">case</span> maybe <span class="kw">of</span>
                        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="st">&quot;&quot;</span>
                        <span class="dt">Just</span> x  <span class="ot">-&gt;</span> gShow x</code></pre></div>
<h4 id="main.purs">Main.purs</h4>
<p>At long last we arrive at <code>main</code> where our matrix inverse calculator begins.</p>
<p>Make sure to open up your favorite text editor and replace <code>Main.purs</code> with the following code.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">{-</span>
<span class="co">  (C) 2017 David Lettier</span>
<span class="co">  lettier.com</span>
<span class="co">-}</span>

<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Prelude</span>

<span class="kw">import </span><span class="dt">Control.Monad.Eff</span> (<span class="dt">Eff</span>)

<span class="kw">import </span><span class="dt">UI</span> (runApp, <span class="dt">Effects</span>)

<span class="ot">main ::</span> <span class="dt">Eff</span> (<span class="dt">Effects</span> ()) <span class="dt">Unit</span>
main <span class="fu">=</span> runApp</code></pre></div>
<p><code>main</code> takes no input, has side effects (<code>Eff (Effects())</code>), and returns nothing of importance (<code>Unit</code>). Note that <code>Effects</code> and <code>runApp</code> come from our custom module, <code>UI</code>.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="dt">Eff</span> (<span class="dt">Effects</span> ()) <span class="dt">Unit</span>

<span class="co">-- =</span>

<span class="kw">type</span> <span class="dt">Effects</span> eff <span class="fu">=</span> <span class="dt">H.HalogenEffects</span> (<span class="ot">console ::</span> <span class="dt">CONSOLE</span> <span class="fu">|</span> eff)

<span class="co">-- +</span>

<span class="kw">type</span> <span class="dt">HalogenEffects</span> eff <span class="fu">=</span> (<span class="ot">avar ::</span> <span class="dt">AVAR</span>,<span class="ot"> err ::</span> <span class="dt">EXCEPTION</span>,<span class="ot"> dom ::</span> <span class="dt">DOM</span> <span class="fu">|</span> eff)

<span class="co">-- =</span>

<span class="dt">Eff</span> (<span class="ot">avar ::</span> <span class="dt">AVAR</span>, err, <span class="dt">EXCEPTION</span>,<span class="ot"> dom ::</span> <span class="dt">DOM</span>,<span class="ot"> console ::</span> <span class="dt">CONSOLE</span> <span class="fu">|</span> ()) <span class="dt">Unit</span></code></pre></div>
<p>Taking a closer look at the type alias <code>Effects</code>, we see that it is all of Halogen’s effects (which are asynchronous variables, exceptions, and DOM manipulations) plus sending output to the console.</p>
<blockquote>
PureScript’s purescript-eff package defines a monad called Eff, which is used to handle native effects. The goal of the Eff monad is to provide a typed API for effectful computations, while at the same time generating efficient Javascript.
<footer>
<a href="http://www.purescript.org/learn/eff/">Handling Native Effects with the Eff Monad by Phil Freeman</a>
</footer>
</blockquote>
<h2 id="building">Building</h2>
<p>We have set up and programmed our entire application. At this point we can build the project and finally try out the matrix inverse calculator.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> matrix-inverse-calculator
<span class="kw">yarn</span> run buildDist
<span class="kw">cd</span> dist
<span class="kw">xdg-open</span> index.html <span class="co"># Or point your browser to file://.../matrix-inverse-calculator/dist/index.html</span></code></pre></div>
<h2 id="wrap-up">Wrap-up</h2>
<p>From the ground up, we implemented a matrix inverse calculator using <a href="http://www.purescript.org/">PureScript</a> and <a href="https://github.com/slamdata/purescript-halogen">PureScript-Halogen</a>. We discussed using NVM and Yarn to manage our dependencies and automate the building of our project. We looked at the what, why, and how of inverting a matrix. We covered the basic Gauss-Jordan elimination algorithm for turning the input matrix into the identity matrix and the identity matrix into the inverse of the input matrix. We took our pseudo code and turned it into our matrix inverse PureScript module. We defined the dynamically generated HTML and query message handlers that power our user interface. And lastly we compiled and linked our application together getting it ready for distribution.</p>
<p>If you enjoyed this tutorial be sure to read <a href="../posts/2017-01-15-linear-regression-and-the-amazing-beard.html">Let’s make a Linear Regression Calculator with PureScript</a> where we use PureScript to make an interactive, browser-based simple linear regression calculator.</p>
</div>
<div class="post-footer">
  <div class="display-left">
    <h2 class="post-footer-cta">
      Don't miss out&mdash;click <a href="../posts.html" title="posts">posts</a> or
      subscribe via <a href="../rss.xml" type="application/rss+xml" target="_blank" title="RSS">RSS</a> for more content.
      <!--Return to the <a href="#top" title="top">top</a>.-->
    </h2>
  </div>
  <div class="display-right text-align-right post-footer-copyright">
    <h4>
      <i class="fa fa-copyright"></i> <span id="copyrightYear">2015</span> David Lettier.
    </h4>
  </div>
</div>
<script>
  (function () {
    document.getElementById('copyrightYear').innerHTML = new Date().getFullYear();
  })();
</script>

    </div>
    <div class="share-toolbox addthis_sharing_toolbox"></div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4fc2bc7a00a9352b"></script>
    <script>
      (function(i,s,o,g,r,a,m){
        i.GoogleAnalyticsObject = r;
        i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments); };
        i[r].l=1*new Date();
        a=s.createElement(o);
        m=s.getElementsByTagName(o)[0];
        a.async=1;
        a.src=g;
        m.parentNode.insertBefore(a,m);
      })(
        window,
        document,
        'script',
        '//www.google-analytics.com/analytics.js',
        'ga'
      );
      ga('create', 'UA-34323684-2', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
